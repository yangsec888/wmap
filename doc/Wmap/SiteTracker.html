<!DOCTYPE html>

<html>
<head>
<meta charset="UTF-8">

<title>class Wmap::SiteTracker - RDoc Documentation</title>

<script type="text/javascript">
  var rdoc_rel_prefix = "../";
</script>

<script src="../js/jquery.js"></script>
<script src="../js/darkfish.js"></script>

<link href="../css/fonts.css" rel="stylesheet">
<link href="../css/rdoc.css" rel="stylesheet">



<body id="top" role="document" class="class">
<nav role="navigation">
  <div id="project-navigation">
    <div id="home-section" role="region" title="Quick navigation" class="nav-section">
  <h2>
    <a href="../index.html" rel="home">Home</a>
  </h2>

  <div id="table-of-contents-navigation">
    <a href="../table_of_contents.html#pages">Pages</a>
    <a href="../table_of_contents.html#classes">Classes</a>
    <a href="../table_of_contents.html#methods">Methods</a>
  </div>
</div>

    <div id="search-section" role="search" class="project-section initially-hidden">
  <form action="#" method="get" accept-charset="utf-8">
    <div id="search-field-wrapper">
      <input id="search-field" role="combobox" aria-label="Search"
             aria-autocomplete="list" aria-controls="search-results"
             type="text" name="search" placeholder="Search" spellcheck="false"
             title="Type to search, Up and Down to navigate, Enter to load">
    </div>

    <ul id="search-results" aria-label="Search Results"
        aria-busy="false" aria-expanded="false"
        aria-atomic="false" class="initially-hidden"></ul>
  </form>
</div>

  </div>

  

  <div id="class-metadata">
    
    <div id="parent-class-section" class="nav-section">
  <h3>Parent</h3>

  
  <p class="link"><a href="../Object.html">Object</a>
  
</div>

    <div id="includes-section" class="nav-section">
  <h3>Included Modules</h3>

  <ul class="link-list">
  
  
    <li><a class="include" href="Utils.html">Wmap::Utils</a>
  
  
  
    <li><span class="include">Singleton</span>
  
  
  </ul>
</div>

    
    <!-- Method Quickref -->
<div id="method-list-section" class="nav-section">
  <h3>Methods</h3>

  <ul class="link-list" role="directory">
    
    <li ><a href="#method-c-new">::new</a>
    
    <li ><a href="#method-i-add">#add</a>
    
    <li ><a href="#method-i-adds">#adds</a>
    
    <li ><a href="#method-i-bulk_add">#bulk_add</a>
    
    <li ><a href="#method-i-bulk_delete">#bulk_delete</a>
    
    <li ><a href="#method-i-bulk_refresh">#bulk_refresh</a>
    
    <li ><a href="#method-i-check">#check</a>
    
    <li ><a href="#method-i-count">#count</a>
    
    <li ><a href="#method-i-del">#del</a>
    
    <li ><a href="#method-i-delete">#delete</a>
    
    <li ><a href="#method-i-dels">#dels</a>
    
    <li ><a href="#method-i-dump">#dump</a>
    
    <li ><a href="#method-i-dump_xml">#dump_xml</a>
    
    <li ><a href="#method-i-file_add">#file_add</a>
    
    <li ><a href="#method-i-file_del">#file_del</a>
    
    <li ><a href="#method-i-file_delete">#file_delete</a>
    
    <li ><a href="#method-i-file_refresh">#file_refresh</a>
    
    <li ><a href="#method-i-get_ext">#get_ext</a>
    
    <li ><a href="#method-i-get_ext_sites">#get_ext_sites</a>
    
    <li ><a href="#method-i-get_int">#get_int</a>
    
    <li ><a href="#method-i-get_int_sites">#get_int_sites</a>
    
    <li ><a href="#method-i-get_ip_sites">#get_ip_sites</a>
    
    <li ><a href="#method-i-get_prim_uniq_sites">#get_prim_uniq_sites</a>
    
    <li ><a href="#method-i-get_prime">#get_prime</a>
    
    <li ><a href="#method-i-get_redirection_url">#get_redirection_url</a>
    
    <li ><a href="#method-i-get_redirection_urls">#get_redirection_urls</a>
    
    <li ><a href="#method-i-get_ssl_sites">#get_ssl_sites</a>
    
    <li ><a href="#method-i-get_uniq_sites">#get_uniq_sites</a>
    
    <li ><a href="#method-i-is_known-3F">#is_known?</a>
    
    <li ><a href="#method-i-load_site_stores_from_file">#load_site_stores_from_file</a>
    
    <li ><a href="#method-i-print">#print</a>
    
    <li ><a href="#method-i-print_all">#print_all</a>
    
    <li ><a href="#method-i-print_all_sites">#print_all_sites</a>
    
    <li ><a href="#method-i-print_ext">#print_ext</a>
    
    <li ><a href="#method-i-print_ext_sites">#print_ext_sites</a>
    
    <li ><a href="#method-i-print_int">#print_int</a>
    
    <li ><a href="#method-i-print_int_sites">#print_int_sites</a>
    
    <li ><a href="#method-i-print_ip_sites">#print_ip_sites</a>
    
    <li ><a href="#method-i-print_site">#print_site</a>
    
    <li ><a href="#method-i-print_ssl_sites">#print_ssl_sites</a>
    
    <li ><a href="#method-i-print_uniq_sites">#print_uniq_sites</a>
    
    <li ><a href="#method-i-refresh">#refresh</a>
    
    <li ><a href="#method-i-refresh_all">#refresh_all</a>
    
    <li ><a href="#method-i-refresh_ip_sites">#refresh_ip_sites</a>
    
    <li ><a href="#method-i-refresh_uniq_sites">#refresh_uniq_sites</a>
    
    <li ><a href="#method-i-refreshs">#refreshs</a>
    
    <li ><a href="#method-i-resolve_ip_sites">#resolve_ip_sites</a>
    
    <li ><a href="#method-i-save-21">#save!</a>
    
    <li ><a href="#method-i-save_sites_to_file-21">#save_sites_to_file!</a>
    
    <li ><a href="#method-i-save_uniq_sites">#save_uniq_sites</a>
    
    <li ><a href="#method-i-save_uniq_sites_xml">#save_uniq_sites_xml</a>
    
    <li ><a href="#method-i-search">#search</a>
    
    <li ><a href="#method-i-site_check">#site_check</a>
    
    <li ><a href="#method-i-site_ip_known-3F">#site_ip_known?</a>
    
    <li ><a href="#method-i-site_known-3F">#site_known?</a>
    
    <li ><a href="#method-i-siteip_known-3F">#siteip_known?</a>
    
    <li ><a href="#method-i-uniq_sites">#uniq_sites</a>
    
  </ul>
</div>

  </div>
</nav>

<main role="main" aria-labelledby="class-Wmap::SiteTracker">
  <h1 id="class-Wmap::SiteTracker" class="class">
    class Wmap::SiteTracker
  </h1>

  <section class="description">
    
<p>Main class to automatically track the site inventory</p>

  </section>

  
  
  
  <section id="5Buntitled-5D" class="documentation-section">
    

    

    

    

    
     <section id="public-class-5Buntitled-5D-method-details" class="method-section">
       <header>
         <h3>Public Class Methods</h3>
       </header>

    
      <div id="method-c-new" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">new</span><span
            class="method-args">(params = {})</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Set default instance variables</p>
          
          

          
          <div class="method-source-code" id="new-source">
            <pre><span class="ruby-comment"># File lib/wmap/site_tracker.rb, line 22</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">initialize</span> (<span class="ruby-identifier">params</span> = {})
        <span class="ruby-comment"># Initialize the instance variables</span>
        <span class="ruby-ivar">@f_sites</span>=<span class="ruby-constant">File</span>.<span class="ruby-identifier">dirname</span>(<span class="ruby-keyword">__FILE__</span>)<span class="ruby-operator">+</span><span class="ruby-string">&#39;/../../data/sites&#39;</span>
        <span class="ruby-ivar">@file_stores</span>=<span class="ruby-identifier">params</span>.<span class="ruby-identifier">fetch</span>(<span class="ruby-value">:sites_file</span>, <span class="ruby-ivar">@f_sites</span>)
        <span class="ruby-ivar">@verbose</span>=<span class="ruby-identifier">params</span>.<span class="ruby-identifier">fetch</span>(<span class="ruby-value">:verbose</span>, <span class="ruby-keyword">false</span>)
        <span class="ruby-ivar">@max_parallel</span>=<span class="ruby-identifier">params</span>.<span class="ruby-identifier">fetch</span>(<span class="ruby-value">:max_parallel</span>, <span class="ruby-value">30</span>)
        <span class="ruby-comment"># Hash table to hold the site store</span>
        <span class="ruby-ivar">@known_sites</span>=<span class="ruby-identifier">load_site_stores_from_file</span>(<span class="ruby-ivar">@file_stores</span>)         
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
    </section>
  
     <section id="public-instance-5Buntitled-5D-method-details" class="method-section">
       <header>
         <h3>Public Instance Methods</h3>
       </header>

    
      <div id="method-i-add" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">add</span><span
            class="method-args">(site)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Setter to add site entry to the cache one at a time</p>
          
          

          
          <div class="method-source-code" id="add-source">
            <pre><span class="ruby-comment"># File lib/wmap/site_tracker.rb, line 102</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">add</span>(<span class="ruby-identifier">site</span>)
        <span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;Add entry to the site store: #{site}&quot;</span> 
        <span class="ruby-keyword">begin</span>
                <span class="ruby-comment"># Preliminary sanity check </span>
                <span class="ruby-identifier">site</span>=<span class="ruby-identifier">site</span>.<span class="ruby-identifier">strip</span>.<span class="ruby-identifier">downcase</span> <span class="ruby-keyword">unless</span> <span class="ruby-identifier">site</span>.<span class="ruby-identifier">nil?</span>                    
                <span class="ruby-identifier">raise</span> <span class="ruby-node">&quot;Site is already exist. Skip #{site}&quot;</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">site_known?</span>(<span class="ruby-identifier">site</span>)     
                <span class="ruby-identifier">site</span>=<span class="ruby-identifier">normalize_url</span>(<span class="ruby-identifier">site</span>) <span class="ruby-keyword">if</span> <span class="ruby-identifier">is_url?</span>(<span class="ruby-identifier">site</span>)
                <span class="ruby-identifier">site</span>=<span class="ruby-identifier">url_2_site</span>(<span class="ruby-identifier">site</span>) <span class="ruby-keyword">if</span> <span class="ruby-identifier">is_url?</span>(<span class="ruby-identifier">site</span>)
                <span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;Site in standard format: #{site}&quot;</span> <span class="ruby-keyword">if</span> <span class="ruby-ivar">@verbose</span>
                <span class="ruby-identifier">raise</span> <span class="ruby-node">&quot;Exception on method #{__method__}: invalid site format of #{site}. Expected format is: http://your_website_name/&quot;</span> <span class="ruby-keyword">unless</span> <span class="ruby-identifier">is_site?</span>(<span class="ruby-identifier">site</span>)
                <span class="ruby-identifier">trusted</span>=<span class="ruby-keyword">false</span>        
                <span class="ruby-identifier">host</span>=<span class="ruby-identifier">url_2_host</span>(<span class="ruby-identifier">site</span>)
                <span class="ruby-identifier">ip</span>=<span class="ruby-identifier">host_2_ip</span>(<span class="ruby-identifier">host</span>)
                <span class="ruby-comment"># Additional logic to refresh deactivated site, 02/12/2014</span>
                <span class="ruby-identifier">deact</span>=<span class="ruby-constant">Wmap</span><span class="ruby-operator">::</span><span class="ruby-constant">SiteTracker</span><span class="ruby-operator">::</span><span class="ruby-constant">DeactivatedSite</span>.<span class="ruby-identifier">instance</span>
                <span class="ruby-comment"># only trust either the domain or IP we know</span>
                <span class="ruby-keyword">if</span> <span class="ruby-identifier">is_ip?</span>(<span class="ruby-identifier">host</span>)
                        <span class="ruby-identifier">trusted</span>=<span class="ruby-constant">Wmap</span>.<span class="ruby-identifier">ip_trusted?</span>(<span class="ruby-identifier">ip</span>)
                <span class="ruby-keyword">else</span>
                        <span class="ruby-identifier">root</span>=<span class="ruby-identifier">get_domain_root</span>(<span class="ruby-identifier">host</span>)
                        <span class="ruby-keyword">if</span> <span class="ruby-identifier">root</span>.<span class="ruby-identifier">nil?</span>
                                <span class="ruby-identifier">raise</span> <span class="ruby-string">&quot;Invalid web site format. Please check your record again.&quot;</span>
                        <span class="ruby-keyword">else</span>
                                <span class="ruby-identifier">trusted</span>=<span class="ruby-constant">Wmap</span>.<span class="ruby-identifier">domain_known?</span>(<span class="ruby-identifier">root</span>)
                        <span class="ruby-keyword">end</span>
                <span class="ruby-keyword">end</span>                  
                <span class="ruby-comment"># add record only if trusted</span>
                <span class="ruby-keyword">if</span> <span class="ruby-identifier">trusted</span>
                        <span class="ruby-comment"># Add logic to check site status before adding it</span>
                        <span class="ruby-identifier">checker</span>=<span class="ruby-constant">Wmap</span>.<span class="ruby-identifier">check</span>(<span class="ruby-identifier">site</span>)
                        <span class="ruby-identifier">raise</span> <span class="ruby-node">&quot;Site is currently down. Skip #{site}&quot;</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">checker</span>.<span class="ruby-identifier">nil?</span>
                        <span class="ruby-comment"># Skip the http site if it&#39;s un-responsive; for the https we&#39;ll keep it because we&#39;re interested in analysing the SSL layer later</span>
                        <span class="ruby-keyword">if</span> <span class="ruby-identifier">is_https?</span>(<span class="ruby-identifier">site</span>)
                                <span class="ruby-comment"># do nothing</span>
                        <span class="ruby-keyword">else</span>
                                <span class="ruby-identifier">raise</span> <span class="ruby-node">&quot;Site is currently down. Skip #{site}&quot;</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">checker</span>[<span class="ruby-string">&#39;code&#39;</span>]<span class="ruby-operator">==</span><span class="ruby-value">10000</span> 
                        <span class="ruby-keyword">end</span>
                        <span class="ruby-identifier">raise</span> <span class="ruby-node">&quot;Exception on add method - Fail to resolve the host-name: Host - #{host}, IP - #{ip}. Skip #{site}&quot;</span> <span class="ruby-keyword">unless</span> <span class="ruby-identifier">is_ip?</span>(<span class="ruby-identifier">ip</span>)                 
                        <span class="ruby-comment"># Update the local host table when necessary</span>
                        <span class="ruby-keyword">if</span> <span class="ruby-identifier">is_ip?</span>(<span class="ruby-identifier">host</span>)
                                <span class="ruby-comment"># Case #1: Trusted site contains IP</span>
                                <span class="ruby-keyword">if</span> <span class="ruby-constant">Wmap</span><span class="ruby-operator">::</span><span class="ruby-constant">HostTracker</span>.<span class="ruby-identifier">instance</span>.<span class="ruby-identifier">ip_known?</span>(<span class="ruby-identifier">host</span>)
                                        <span class="ruby-comment"># Try local reverse DNS lookup first</span>
                                        <span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;Local hosts table lookup for IP: #{ip}&quot;</span> <span class="ruby-keyword">if</span> <span class="ruby-ivar">@verbose</span>
                                        <span class="ruby-identifier">host</span>=<span class="ruby-constant">Wmap</span><span class="ruby-operator">::</span><span class="ruby-constant">HostTracker</span>.<span class="ruby-identifier">instance</span>.<span class="ruby-identifier">local_ip_2_host</span>(<span class="ruby-identifier">host</span>)
                                        <span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;Host found from the local hosts table for #{ip}: #{host}&quot;</span> <span class="ruby-keyword">if</span> <span class="ruby-ivar">@verbose</span>
                                        <span class="ruby-identifier">site</span>.<span class="ruby-identifier">sub!</span>(<span class="ruby-regexp">/\d+\.\d+\.\d+\.\d+/</span>,<span class="ruby-identifier">host</span>)
                                <span class="ruby-keyword">else</span>
                                        <span class="ruby-comment"># Try reverse DNS lookup over Internet as secondary precaution</span>
                                        <span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;Reverse DNS lookup for IP: #{ip}&quot;</span> <span class="ruby-keyword">if</span> <span class="ruby-ivar">@verbose</span>
                                        <span class="ruby-identifier">host1</span>=<span class="ruby-identifier">ip_2_host</span>(<span class="ruby-identifier">host</span>)
                                        <span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;host1: #{host1}&quot;</span> <span class="ruby-keyword">if</span> <span class="ruby-ivar">@verbose</span>
                                        <span class="ruby-keyword">if</span> <span class="ruby-identifier">is_fqdn?</span>(<span class="ruby-identifier">host1</span>) 
                                                <span class="ruby-keyword">if</span> <span class="ruby-constant">Wmap</span>.<span class="ruby-identifier">domain_known?</span>(<span class="ruby-identifier">host1</span>)
                                                        <span class="ruby-comment"># replace IP with host-name only if domain root is known </span>
                                                        <span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;Host found from the Internet reverse DNS lookup for #{ip}: #{host1}&quot;</span> <span class="ruby-keyword">if</span> <span class="ruby-ivar">@verbose</span>
                                                        <span class="ruby-identifier">host</span>=<span class="ruby-identifier">host1</span>
                                                        <span class="ruby-identifier">site</span>.<span class="ruby-identifier">sub!</span>(<span class="ruby-regexp">/\d+\.\d+\.\d+\.\d+/</span>,<span class="ruby-identifier">host</span>)
                                                <span class="ruby-keyword">end</span>
                                        <span class="ruby-keyword">end</span>
                                <span class="ruby-keyword">end</span>
                                <span class="ruby-comment"># Adding site for Case #1                                  </span>
                                <span class="ruby-identifier">raise</span> <span class="ruby-node">&quot;Site already exist! Skip #{site}&quot;</span> <span class="ruby-keyword">if</span> <span class="ruby-ivar">@known_sites</span>.<span class="ruby-identifier">key?</span>(<span class="ruby-identifier">site</span>)                                
                                <span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;Adding site: #{site}&quot;</span> <span class="ruby-keyword">if</span> <span class="ruby-ivar">@verbose</span>
                                <span class="ruby-ivar">@known_sites</span>[<span class="ruby-identifier">site</span>]=<span class="ruby-constant">Hash</span>.<span class="ruby-identifier">new</span> 
                                <span class="ruby-ivar">@known_sites</span>[<span class="ruby-identifier">site</span>]=<span class="ruby-identifier">checker</span>
                                <span class="ruby-keyword">if</span> <span class="ruby-identifier">deact</span>.<span class="ruby-identifier">site_known?</span>(<span class="ruby-identifier">site</span>)
                                        <span class="ruby-identifier">deact</span>.<span class="ruby-identifier">delete</span>(<span class="ruby-identifier">site</span>)
                                        <span class="ruby-identifier">deact</span>.<span class="ruby-identifier">save!</span>
                                <span class="ruby-keyword">end</span>
                                <span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;Site entry loaded: #{checker}&quot;</span>
                                <span class="ruby-keyword">if</span> <span class="ruby-identifier">is_fqdn?</span>(<span class="ruby-identifier">host</span>)
                                <span class="ruby-comment"># Add logic to update the hosts table for case #1 variance</span>
                                <span class="ruby-comment"># -  case that reverse DNS lookup successful</span>
                                        <span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;Update local hosts table for host: #{host}&quot;</span>
                                        <span class="ruby-keyword">if</span> <span class="ruby-constant">Wmap</span><span class="ruby-operator">::</span><span class="ruby-constant">HostTracker</span>.<span class="ruby-identifier">instance</span>.<span class="ruby-identifier">host_known?</span>(<span class="ruby-identifier">host</span>)
                                                <span class="ruby-identifier">old_ip</span>=<span class="ruby-constant">Wmap</span><span class="ruby-operator">::</span><span class="ruby-constant">HostTracker</span>.<span class="ruby-identifier">instance</span>.<span class="ruby-identifier">local_host_2_ip</span>(<span class="ruby-identifier">host</span>)
                                                <span class="ruby-keyword">if</span> <span class="ruby-identifier">old_ip</span> <span class="ruby-operator">!=</span> <span class="ruby-identifier">ip</span>
                                                        <span class="ruby-constant">Wmap</span><span class="ruby-operator">::</span><span class="ruby-constant">HostTracker</span>.<span class="ruby-identifier">instance</span>.<span class="ruby-identifier">refresh</span>(<span class="ruby-identifier">host</span>)
                                                        <span class="ruby-constant">Wmap</span><span class="ruby-operator">::</span><span class="ruby-constant">HostTracker</span>.<span class="ruby-identifier">instance</span>.<span class="ruby-identifier">save!</span>
                                                <span class="ruby-keyword">else</span>
                                                        <span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;Host resolve to the same IP #{ip} - no need to update the local host table.&quot;</span> <span class="ruby-keyword">if</span> <span class="ruby-ivar">@verbose</span>
                                                <span class="ruby-keyword">end</span>
                                        <span class="ruby-keyword">else</span>
                                                <span class="ruby-constant">Wmap</span><span class="ruby-operator">::</span><span class="ruby-constant">HostTracker</span>.<span class="ruby-identifier">instance</span>.<span class="ruby-identifier">add</span>(<span class="ruby-identifier">host</span>)
                                                <span class="ruby-constant">Wmap</span><span class="ruby-operator">::</span><span class="ruby-constant">HostTracker</span>.<span class="ruby-identifier">instance</span>.<span class="ruby-identifier">save!</span>
                                        <span class="ruby-keyword">end</span>
                                <span class="ruby-keyword">end</span>        
                        <span class="ruby-keyword">else</span>
                                <span class="ruby-comment"># Case #2: Trusted site contains valid FQDN</span>
                                <span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;Ading site: #{site}&quot;</span> <span class="ruby-keyword">if</span> <span class="ruby-ivar">@verbose</span>
                                <span class="ruby-ivar">@known_sites</span>[<span class="ruby-identifier">site</span>]=<span class="ruby-constant">Hash</span>.<span class="ruby-identifier">new</span> 
                                <span class="ruby-ivar">@known_sites</span>[<span class="ruby-identifier">site</span>]=<span class="ruby-identifier">checker</span>
                                <span class="ruby-keyword">if</span> <span class="ruby-identifier">deact</span>.<span class="ruby-identifier">site_known?</span>(<span class="ruby-identifier">site</span>)
                                        <span class="ruby-identifier">deact</span>.<span class="ruby-identifier">delete</span>(<span class="ruby-identifier">site</span>)
                                        <span class="ruby-identifier">deact</span>.<span class="ruby-identifier">save!</span>
                                <span class="ruby-keyword">end</span>
                                <span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;Site entry loaded: #{checker}&quot;</span>
                                <span class="ruby-comment"># Add logic to update the hosts table for case #2</span>
                                <span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;Update local hosts table for host: #{host}&quot;</span>
                                <span class="ruby-keyword">if</span> <span class="ruby-constant">Wmap</span><span class="ruby-operator">::</span><span class="ruby-constant">HostTracker</span>.<span class="ruby-identifier">instance</span>.<span class="ruby-identifier">host_known?</span>(<span class="ruby-identifier">host</span>)
                                        <span class="ruby-identifier">old_ip</span>=<span class="ruby-constant">Wmap</span><span class="ruby-operator">::</span><span class="ruby-constant">HostTracker</span>.<span class="ruby-identifier">instance</span>.<span class="ruby-identifier">local_host_2_ip</span>(<span class="ruby-identifier">host</span>)
                                        <span class="ruby-keyword">if</span> <span class="ruby-identifier">old_ip</span> <span class="ruby-operator">!=</span> <span class="ruby-identifier">ip</span>
                                                <span class="ruby-constant">Wmap</span><span class="ruby-operator">::</span><span class="ruby-constant">HostTracker</span>.<span class="ruby-identifier">instance</span>.<span class="ruby-identifier">refresh</span>(<span class="ruby-identifier">host</span>)
                                                <span class="ruby-constant">Wmap</span><span class="ruby-operator">::</span><span class="ruby-constant">HostTracker</span>.<span class="ruby-identifier">instance</span>.<span class="ruby-identifier">save!</span>
                                        <span class="ruby-keyword">else</span>
                                                <span class="ruby-comment"># Skip - no need to update the local hosts table</span>
                                        <span class="ruby-keyword">end</span>
                                <span class="ruby-keyword">else</span>
                                        <span class="ruby-constant">Wmap</span><span class="ruby-operator">::</span><span class="ruby-constant">HostTracker</span>.<span class="ruby-identifier">instance</span>.<span class="ruby-identifier">add</span>(<span class="ruby-identifier">host</span>)
                                        <span class="ruby-constant">Wmap</span><span class="ruby-operator">::</span><span class="ruby-constant">HostTracker</span>.<span class="ruby-identifier">instance</span>.<span class="ruby-identifier">save!</span>
                                <span class="ruby-keyword">end</span>
                        <span class="ruby-keyword">end</span>
                        <span class="ruby-identifier">deact</span>=<span class="ruby-keyword">nil</span>
                        <span class="ruby-keyword">return</span> <span class="ruby-identifier">checker</span>
                <span class="ruby-keyword">else</span>
                        <span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;Problem found: untrusted Internet domain or IP. Skip #{site}&quot;</span>
                        <span class="ruby-identifier">deact</span>=<span class="ruby-keyword">nil</span>
                        <span class="ruby-keyword">return</span> <span class="ruby-keyword">nil</span>
                <span class="ruby-keyword">end</span>                  
        <span class="ruby-keyword">rescue</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">ee</span>                  
                <span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;Exception on method #{__method__}: #{ee}&quot;</span> 
                <span class="ruby-identifier">deact</span>=<span class="ruby-keyword">nil</span>
                <span class="ruby-keyword">return</span> <span class="ruby-keyword">nil</span>
        <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-adds" class="method-detail method-alias">
        
        <div class="method-heading">
          <span class="method-name">adds</span><span
            class="method-args">(list,num=@max_parallel)</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
        </div>

        

        
        <div class="aliases">
          Alias for: <a href="SiteTracker.html#method-i-bulk_add">bulk_add</a>
        </div>
        
      </div>

    
      <div id="method-i-bulk_add" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">bulk_add</span><span
            class="method-args">(list,num=@max_parallel)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Setter to add site entry to the cache in batch (from a list)</p>
          
          

          
          <div class="method-source-code" id="bulk_add-source">
            <pre><span class="ruby-comment"># File lib/wmap/site_tracker.rb, line 245</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">bulk_add</span>(<span class="ruby-identifier">list</span>,<span class="ruby-identifier">num</span>=<span class="ruby-ivar">@max_parallel</span>)
        <span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;Add entries to the local site store from list:\n #{list}&quot;</span> 
        <span class="ruby-keyword">begin</span>
                <span class="ruby-identifier">results</span>=<span class="ruby-constant">Hash</span>.<span class="ruby-identifier">new</span>
                <span class="ruby-keyword">if</span> <span class="ruby-identifier">list</span>.<span class="ruby-identifier">size</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span>
                        <span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;Start parallel adding on the sites:\n #{list}&quot;</span>
                        <span class="ruby-constant">Parallel</span>.<span class="ruby-identifier">map</span>(<span class="ruby-identifier">list</span>, <span class="ruby-value">:in_processes</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">num</span>) { <span class="ruby-operator">|</span><span class="ruby-identifier">target</span><span class="ruby-operator">|</span>
                                <span class="ruby-identifier">add</span>(<span class="ruby-identifier">target</span>)
                        }.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">process</span><span class="ruby-operator">|</span>                                 
                                <span class="ruby-keyword">if</span> <span class="ruby-identifier">process</span>.<span class="ruby-identifier">nil?</span>
                                        <span class="ruby-keyword">next</span>
                                <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">process</span>.<span class="ruby-identifier">empty?</span>
                                        <span class="ruby-comment">#do nothing</span>
                                <span class="ruby-keyword">else</span>
                                        <span class="ruby-identifier">results</span>[<span class="ruby-identifier">process</span>[<span class="ruby-string">&#39;url&#39;</span>]]=<span class="ruby-constant">Hash</span>.<span class="ruby-identifier">new</span>
                                        <span class="ruby-identifier">results</span>[<span class="ruby-identifier">process</span>[<span class="ruby-string">&#39;url&#39;</span>]]=<span class="ruby-identifier">process</span>
                                <span class="ruby-keyword">end</span>                                
                        <span class="ruby-keyword">end</span>
                        <span class="ruby-ivar">@known_sites</span>.<span class="ruby-identifier">merge!</span>(<span class="ruby-identifier">results</span>)
                <span class="ruby-keyword">else</span>
                        <span class="ruby-identifier">puts</span> <span class="ruby-string">&quot;Error: no entry is added. Please check your list and try again.&quot;</span>
                <span class="ruby-keyword">end</span>
                <span class="ruby-identifier">puts</span> <span class="ruby-string">&quot;Done adding site entries.&quot;</span>
                <span class="ruby-keyword">if</span> <span class="ruby-identifier">results</span>.<span class="ruby-identifier">size</span><span class="ruby-operator">&gt;</span><span class="ruby-value">0</span> 
                        <span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;New entries added: #{results}&quot;</span> 
                <span class="ruby-keyword">else</span>
                        <span class="ruby-identifier">puts</span> <span class="ruby-string">&quot;No new entry added. &quot;</span>
                <span class="ruby-keyword">end</span>
                <span class="ruby-keyword">return</span> <span class="ruby-identifier">results</span>
        <span class="ruby-keyword">rescue</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">ee</span>                  
                <span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;Exception on method #{__method__}: #{ee}&quot;</span> <span class="ruby-keyword">if</span> <span class="ruby-ivar">@verbose</span>
        <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        
        <div class="aliases">
          Also aliased as: <a href="SiteTracker.html#method-i-adds">adds</a>
        </div>
        

        
      </div>

    
      <div id="method-i-bulk_delete" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">bulk_delete</span><span
            class="method-args">(list)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Setter to delete site entry to the cache in batch (from a list)</p>
          
          

          
          <div class="method-source-code" id="bulk_delete-source">
            <pre><span class="ruby-comment"># File lib/wmap/site_tracker.rb, line 323</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">bulk_delete</span>(<span class="ruby-identifier">list</span>)
        <span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;Delete entries to the local site store from list:\n #{list}&quot;</span> <span class="ruby-keyword">if</span> <span class="ruby-ivar">@verbose</span>
        <span class="ruby-keyword">begin</span>
                <span class="ruby-identifier">sites</span>=<span class="ruby-identifier">list</span>                   
                <span class="ruby-identifier">changes</span>=<span class="ruby-constant">Array</span>.<span class="ruby-identifier">new</span>
                <span class="ruby-keyword">if</span> <span class="ruby-identifier">sites</span>.<span class="ruby-identifier">size</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span>
                        <span class="ruby-identifier">sites</span>.<span class="ruby-identifier">map</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">x</span><span class="ruby-operator">|</span> 
                                <span class="ruby-identifier">x</span>=<span class="ruby-identifier">url_2_site</span>(<span class="ruby-identifier">x</span>)
                                <span class="ruby-identifier">site</span>=<span class="ruby-identifier">delete</span>(<span class="ruby-identifier">x</span>) 
                                <span class="ruby-identifier">changes</span>.<span class="ruby-identifier">push</span>(<span class="ruby-identifier">site</span>) <span class="ruby-keyword">unless</span> <span class="ruby-identifier">site</span>.<span class="ruby-identifier">nil?</span>
                        <span class="ruby-keyword">end</span>
                        <span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;Done deleting sites from the list:\n #{list}&quot;</span>
                        <span class="ruby-keyword">return</span> <span class="ruby-identifier">changes</span>
                <span class="ruby-keyword">else</span>
                        <span class="ruby-identifier">puts</span> <span class="ruby-string">&quot;Error: no entry is loaded. Please check your list and try again.&quot;</span>
                <span class="ruby-keyword">end</span>
        <span class="ruby-keyword">rescue</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">ee</span>                  
                <span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;Exception on method #{__method__}: #{ee}&quot;</span> <span class="ruby-keyword">if</span> <span class="ruby-ivar">@verbose</span>
        <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        
        <div class="aliases">
          Also aliased as: <a href="SiteTracker.html#method-i-dels">dels</a>
        </div>
        

        
      </div>

    
      <div id="method-i-bulk_refresh" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">bulk_refresh</span><span
            class="method-args">(list,num=@max_parallel)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>&#39;Refresh sites in the site store in batch (from a list)</p>
          
          

          
          <div class="method-source-code" id="bulk_refresh-source">
            <pre><span class="ruby-comment"># File lib/wmap/site_tracker.rb, line 397</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">bulk_refresh</span>(<span class="ruby-identifier">list</span>,<span class="ruby-identifier">num</span>=<span class="ruby-ivar">@max_parallel</span>)
        <span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;Refresh entries in the site store from list:\n #{list}&quot;</span> <span class="ruby-keyword">if</span> <span class="ruby-ivar">@verbose</span>
        <span class="ruby-keyword">begin</span>
                <span class="ruby-identifier">results</span>=<span class="ruby-constant">Hash</span>.<span class="ruby-identifier">new</span>
                <span class="ruby-keyword">if</span> <span class="ruby-identifier">list</span>.<span class="ruby-identifier">size</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span>
                        <span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;Start parallel refreshing on the sites:\n #{list}&quot;</span>
                        <span class="ruby-constant">Parallel</span>.<span class="ruby-identifier">map</span>(<span class="ruby-identifier">list</span>, <span class="ruby-value">:in_processes</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">num</span>) { <span class="ruby-operator">|</span><span class="ruby-identifier">target</span><span class="ruby-operator">|</span>
                                <span class="ruby-identifier">refresh</span>(<span class="ruby-identifier">target</span>)
                        }.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">process</span><span class="ruby-operator">|</span>                                 
                                <span class="ruby-keyword">if</span> <span class="ruby-identifier">process</span>.<span class="ruby-identifier">nil?</span>
                                        <span class="ruby-keyword">next</span>
                                <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">process</span>.<span class="ruby-identifier">empty?</span>
                                        <span class="ruby-comment">#do nothing</span>
                                <span class="ruby-keyword">else</span>
                                        <span class="ruby-identifier">results</span>[<span class="ruby-identifier">process</span>[<span class="ruby-string">&#39;url&#39;</span>]]=<span class="ruby-constant">Hash</span>.<span class="ruby-identifier">new</span>
                                        <span class="ruby-identifier">results</span>[<span class="ruby-identifier">process</span>[<span class="ruby-string">&#39;url&#39;</span>]]=<span class="ruby-identifier">process</span>
                                <span class="ruby-keyword">end</span>                                
                        <span class="ruby-keyword">end</span>
                        <span class="ruby-comment"># Clean up old entries, by Y.L. 03/30/2015</span>
                        <span class="ruby-identifier">list</span>.<span class="ruby-identifier">map</span> {<span class="ruby-operator">|</span><span class="ruby-identifier">x</span><span class="ruby-operator">|</span> <span class="ruby-ivar">@known_sites</span>.<span class="ruby-identifier">delete</span>(<span class="ruby-identifier">x</span>)}
                        <span class="ruby-comment"># Add back fresh entries</span>
                        <span class="ruby-ivar">@known_sites</span>.<span class="ruby-identifier">merge!</span>(<span class="ruby-identifier">results</span>)
                        <span class="ruby-identifier">puts</span> <span class="ruby-string">&quot;Done refresh sites.&quot;</span>
                <span class="ruby-keyword">else</span>
                        <span class="ruby-identifier">puts</span> <span class="ruby-string">&quot;Error: no entry is loaded. Please check your list and try again.&quot;</span>
                <span class="ruby-keyword">end</span>
                <span class="ruby-keyword">return</span> <span class="ruby-identifier">results</span>
        <span class="ruby-keyword">rescue</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">ee</span>                  
                <span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;Exception on method #{__method__}: #{ee}&quot;</span> <span class="ruby-keyword">if</span> <span class="ruby-ivar">@verbose</span>
        <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        
        <div class="aliases">
          Also aliased as: <a href="SiteTracker.html#method-i-refreshs">refreshs</a>
        </div>
        

        
      </div>

    
      <div id="method-i-check" class="method-detail method-alias">
        
        <div class="method-heading">
          <span class="method-name">check</span><span
            class="method-args">(site)</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
        </div>

        

        
        <div class="aliases">
          Alias for: <a href="SiteTracker.html#method-i-site_check">site_check</a>
        </div>
        
      </div>

    
      <div id="method-i-count" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">count</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Count numbers of entries in the site store table</p>
          
          

          
          <div class="method-source-code" id="count-source">
            <pre><span class="ruby-comment"># File lib/wmap/site_tracker.rb, line 92</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">count</span>
        <span class="ruby-identifier">puts</span> <span class="ruby-string">&quot;Counting number of entries in the site store table ...&quot;</span>
        <span class="ruby-keyword">begin</span>
                <span class="ruby-keyword">return</span> <span class="ruby-ivar">@known_sites</span>.<span class="ruby-identifier">size</span>     
        <span class="ruby-keyword">rescue</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">ee</span>
                <span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;Exception on method #{__method__}: #{ee}&quot;</span> 
        <span class="ruby-keyword">end</span>           
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-del" class="method-detail method-alias">
        
        <div class="method-heading">
          <span class="method-name">del</span><span
            class="method-args">(site)</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
        </div>

        

        
        <div class="aliases">
          Alias for: <a href="SiteTracker.html#method-i-delete">delete</a>
        </div>
        
      </div>

    
      <div id="method-i-delete" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">delete</span><span
            class="method-args">(site)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Setter to remove entry from the site store one at a time</p>
          
          

          
          <div class="method-source-code" id="delete-source">
            <pre><span class="ruby-comment"># File lib/wmap/site_tracker.rb, line 281</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">delete</span>(<span class="ruby-identifier">site</span>)
        <span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;Remove entry from the site store: #{site} &quot;</span> <span class="ruby-keyword">if</span> <span class="ruby-ivar">@verbose</span>
        <span class="ruby-keyword">begin</span>
                <span class="ruby-comment"># Additional logic to deactivate the site properly, by moving it to the DeactivatedSite list, 02/07/2014</span>
                <span class="ruby-identifier">deact</span>=<span class="ruby-constant">Wmap</span><span class="ruby-operator">::</span><span class="ruby-constant">SiteTracker</span><span class="ruby-operator">::</span><span class="ruby-constant">DeactivatedSite</span>.<span class="ruby-identifier">instance</span>
                <span class="ruby-identifier">site</span>=<span class="ruby-identifier">site</span>.<span class="ruby-identifier">strip</span>.<span class="ruby-identifier">downcase</span>
                <span class="ruby-identifier">site</span>=<span class="ruby-identifier">url_2_site</span>(<span class="ruby-identifier">site</span>)
                <span class="ruby-keyword">if</span> <span class="ruby-ivar">@known_sites</span>.<span class="ruby-identifier">key?</span>(<span class="ruby-identifier">site</span>)
                        <span class="ruby-identifier">site_info</span>=<span class="ruby-ivar">@known_sites</span>[<span class="ruby-identifier">site</span>]
                        <span class="ruby-identifier">deact</span>.<span class="ruby-identifier">add</span>(<span class="ruby-identifier">site</span>,<span class="ruby-identifier">site_info</span>)
                        <span class="ruby-identifier">deact</span>.<span class="ruby-identifier">save!</span>
                        <span class="ruby-identifier">deact</span>=<span class="ruby-keyword">nil</span>
                        <span class="ruby-identifier">del</span>=<span class="ruby-ivar">@known_sites</span>.<span class="ruby-identifier">delete</span>(<span class="ruby-identifier">site</span>)
                        <span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;Entry cleared: #{site}&quot;</span>
                        <span class="ruby-keyword">return</span> <span class="ruby-identifier">del</span>
                <span class="ruby-keyword">else</span>
                        <span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;Entry not fund. Skip #{site}&quot;</span>
                        <span class="ruby-identifier">deact</span>=<span class="ruby-keyword">nil</span>
                        <span class="ruby-keyword">return</span> <span class="ruby-keyword">nil</span>
                <span class="ruby-keyword">end</span>                   
        <span class="ruby-keyword">rescue</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">ee</span>                  
                <span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;Exception on method #{__method__}: #{ee}&quot;</span> <span class="ruby-keyword">if</span> <span class="ruby-ivar">@verbose</span>
                <span class="ruby-identifier">deact</span>=<span class="ruby-keyword">nil</span>
        <span class="ruby-keyword">end</span>           
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        
        <div class="aliases">
          Also aliased as: <a href="SiteTracker.html#method-i-del">del</a>
        </div>
        

        
      </div>

    
      <div id="method-i-dels" class="method-detail method-alias">
        
        <div class="method-heading">
          <span class="method-name">dels</span><span
            class="method-args">(list)</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
        </div>

        

        
        <div class="aliases">
          Alias for: <a href="SiteTracker.html#method-i-bulk_delete">bulk_delete</a>
        </div>
        
      </div>

    
      <div id="method-i-dump" class="method-detail method-alias">
        
        <div class="method-heading">
          <span class="method-name">dump</span><span
            class="method-args">(file)</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
        </div>

        

        
        <div class="aliases">
          Alias for: <a href="SiteTracker.html#method-i-save_uniq_sites">save_uniq_sites</a>
        </div>
        
      </div>

    
      <div id="method-i-dump_xml" class="method-detail method-alias">
        
        <div class="method-heading">
          <span class="method-name">dump_xml</span><span
            class="method-args">(file)</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
        </div>

        

        
        <div class="aliases">
          Alias for: <a href="SiteTracker.html#method-i-save_uniq_sites_xml">save_uniq_sites_xml</a>
        </div>
        
      </div>

    
      <div id="method-i-file_add" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">file_add</span><span
            class="method-args">(file)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Setter to add site entry to the cache table in batch (from a file)</p>
          
          

          
          <div class="method-source-code" id="file_add-source">
            <pre><span class="ruby-comment"># File lib/wmap/site_tracker.rb, line 230</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">file_add</span>(<span class="ruby-identifier">file</span>)
        <span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;Add entries to the local site store from file: #{file}&quot;</span> 
        <span class="ruby-keyword">begin</span>
                <span class="ruby-identifier">raise</span> <span class="ruby-node">&quot;File non-exist. Please check your file path and name again: #{file}&quot;</span> <span class="ruby-keyword">unless</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">exist?</span>(<span class="ruby-identifier">file</span>)
                <span class="ruby-identifier">changes</span>=<span class="ruby-constant">Hash</span>.<span class="ruby-identifier">new</span>
                <span class="ruby-identifier">sites</span>=<span class="ruby-identifier">file_2_list</span>(<span class="ruby-identifier">file</span>)                      
                <span class="ruby-identifier">changes</span>=<span class="ruby-identifier">bulk_add</span>(<span class="ruby-identifier">sites</span>) <span class="ruby-keyword">unless</span> <span class="ruby-identifier">sites</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-keyword">or</span> <span class="ruby-identifier">sites</span>.<span class="ruby-identifier">empty?</span>
                <span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;Done loading file #{file}. &quot;</span>
                <span class="ruby-keyword">return</span> <span class="ruby-identifier">changes</span>
        <span class="ruby-keyword">rescue</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">ee</span>                  
                <span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;Exception on method #{__method__}: #{ee}&quot;</span>
        <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-file_del" class="method-detail method-alias">
        
        <div class="method-heading">
          <span class="method-name">file_del</span><span
            class="method-args">(file)</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
        </div>

        

        
        <div class="aliases">
          Alias for: <a href="SiteTracker.html#method-i-file_delete">file_delete</a>
        </div>
        
      </div>

    
      <div id="method-i-file_delete" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">file_delete</span><span
            class="method-args">(file)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Setter to delete site entry to the cache in batch (from a file)</p>
          
          

          
          <div class="method-source-code" id="file_delete-source">
            <pre><span class="ruby-comment"># File lib/wmap/site_tracker.rb, line 309</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">file_delete</span>(<span class="ruby-identifier">file</span>)
        <span class="ruby-keyword">begin</span>
                <span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;Delete entries to the local site store from file: #{file}&quot;</span> <span class="ruby-keyword">if</span> <span class="ruby-ivar">@verbose</span>
                <span class="ruby-identifier">raise</span> <span class="ruby-node">&quot;File non-exist. Please check your file path and name again: #{file}&quot;</span> <span class="ruby-keyword">unless</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">exist?</span>(<span class="ruby-identifier">file</span>)
                <span class="ruby-identifier">sites</span>=<span class="ruby-identifier">file_2_list</span>(<span class="ruby-identifier">file</span>)                      
                <span class="ruby-identifier">changes</span>=<span class="ruby-constant">Array</span>.<span class="ruby-identifier">new</span>
                <span class="ruby-identifier">changes</span>=<span class="ruby-identifier">bulk_delete</span>(<span class="ruby-identifier">sites</span>) <span class="ruby-keyword">unless</span> <span class="ruby-identifier">sites</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-keyword">or</span> <span class="ruby-identifier">sites</span>.<span class="ruby-identifier">empty?</span>
        <span class="ruby-keyword">rescue</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">ee</span>                  
                <span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;Exception on method file_delete: #{ee} for file: #{file}&quot;</span> <span class="ruby-keyword">if</span> <span class="ruby-ivar">@verbose</span>
        <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        
        <div class="aliases">
          Also aliased as: <a href="SiteTracker.html#method-i-file_del">file_del</a>
        </div>
        

        
      </div>

    
      <div id="method-i-file_refresh" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">file_refresh</span><span
            class="method-args">(file)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>&#39;Refresh sites in the site store in batch (from a file)</p>
          
          

          
          <div class="method-source-code" id="file_refresh-source">
            <pre><span class="ruby-comment"># File lib/wmap/site_tracker.rb, line 367</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">file_refresh</span>(<span class="ruby-identifier">file</span>)
        <span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;Refresh entries in the site store from file: #{file}&quot;</span> <span class="ruby-keyword">if</span> <span class="ruby-ivar">@verbose</span>
        <span class="ruby-keyword">begin</span>
                <span class="ruby-identifier">changes</span>=<span class="ruby-constant">Hash</span>.<span class="ruby-identifier">new</span>
                <span class="ruby-identifier">sites</span>=<span class="ruby-identifier">file_2_list</span>(<span class="ruby-identifier">file</span>)                      
                <span class="ruby-identifier">changes</span>=<span class="ruby-identifier">bulk_refresh</span>(<span class="ruby-identifier">sites</span>) <span class="ruby-keyword">unless</span> <span class="ruby-identifier">sites</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-keyword">or</span> <span class="ruby-identifier">sites</span>.<span class="ruby-identifier">empty?</span>
                <span class="ruby-keyword">return</span> <span class="ruby-identifier">changes</span>
        <span class="ruby-keyword">rescue</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">ee</span>                  
                <span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;Exception on method #{__method__}: #{ee} for file: #{file}&quot;</span> <span class="ruby-keyword">if</span> <span class="ruby-ivar">@verbose</span>
        <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-get_ext" class="method-detail method-alias">
        
        <div class="method-heading">
          <span class="method-name">get_ext</span><span
            class="method-args">()</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
        </div>

        

        
        <div class="aliases">
          Alias for: <a href="SiteTracker.html#method-i-get_ext_sites">get_ext_sites</a>
        </div>
        
      </div>

    
      <div id="method-i-get_ext_sites" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">get_ext_sites</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Retrieve external hosted sites into a list</p>
          
          

          
          <div class="method-source-code" id="get_ext_sites-source">
            <pre><span class="ruby-comment"># File lib/wmap/site_tracker.rb, line 511</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">get_ext_sites</span>
        <span class="ruby-identifier">puts</span> <span class="ruby-string">&quot;getter to retrieve all the external hosted sites. &quot;</span> <span class="ruby-keyword">if</span> <span class="ruby-ivar">@verbose</span>
        <span class="ruby-keyword">begin</span>
                <span class="ruby-identifier">sites</span>=<span class="ruby-constant">Array</span>.<span class="ruby-identifier">new</span>
                <span class="ruby-ivar">@known_sites</span>.<span class="ruby-identifier">keys</span>.<span class="ruby-identifier">map</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">key</span><span class="ruby-operator">|</span>
                        <span class="ruby-keyword">if</span> <span class="ruby-ivar">@known_sites</span>[<span class="ruby-identifier">key</span>][<span class="ruby-string">&#39;status&#39;</span>]<span class="ruby-operator">==</span><span class="ruby-string">&quot;ext_hosted&quot;</span>
                                <span class="ruby-identifier">sites</span>.<span class="ruby-identifier">push</span>(<span class="ruby-identifier">key</span>)
                        <span class="ruby-keyword">end</span>
                <span class="ruby-keyword">end</span>
                <span class="ruby-identifier">sites</span>.<span class="ruby-identifier">sort!</span>
                <span class="ruby-keyword">return</span> <span class="ruby-identifier">sites</span>
        <span class="ruby-keyword">rescue</span> <span class="ruby-constant">Exception</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">ee</span>
                <span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;Exception on method #{__method__}: #{ee}&quot;</span> <span class="ruby-keyword">if</span> <span class="ruby-ivar">@verbose</span>
                <span class="ruby-keyword">return</span> <span class="ruby-keyword">nil</span>
        <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        
        <div class="aliases">
          Also aliased as: <a href="SiteTracker.html#method-i-get_ext">get_ext</a>
        </div>
        

        
      </div>

    
      <div id="method-i-get_int" class="method-detail method-alias">
        
        <div class="method-heading">
          <span class="method-name">get_int</span><span
            class="method-args">()</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
        </div>

        

        
        <div class="aliases">
          Alias for: <a href="SiteTracker.html#method-i-get_int_sites">get_int_sites</a>
        </div>
        
      </div>

    
      <div id="method-i-get_int_sites" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">get_int_sites</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Retrieve a list of internal hosted site URLs</p>
          
          

          
          <div class="method-source-code" id="get_int_sites-source">
            <pre><span class="ruby-comment"># File lib/wmap/site_tracker.rb, line 530</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">get_int_sites</span>
        <span class="ruby-identifier">puts</span> <span class="ruby-string">&quot;getter to retrieve all the internal hosted sites.&quot;</span> <span class="ruby-keyword">if</span> <span class="ruby-ivar">@verbose</span>
        <span class="ruby-keyword">begin</span>
                <span class="ruby-identifier">sites</span>=<span class="ruby-constant">Array</span>.<span class="ruby-identifier">new</span>
                <span class="ruby-ivar">@known_sites</span>.<span class="ruby-identifier">keys</span>.<span class="ruby-identifier">map</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">key</span><span class="ruby-operator">|</span>
                        <span class="ruby-keyword">if</span> <span class="ruby-ivar">@known_sites</span>[<span class="ruby-identifier">key</span>][<span class="ruby-string">&#39;status&#39;</span>]<span class="ruby-operator">==</span><span class="ruby-string">&quot;int_hosted&quot;</span>
                                <span class="ruby-identifier">sites</span>.<span class="ruby-identifier">push</span>(<span class="ruby-identifier">key</span>)
                        <span class="ruby-keyword">end</span>
                <span class="ruby-keyword">end</span>
                <span class="ruby-identifier">sites</span>.<span class="ruby-identifier">sort!</span>
                <span class="ruby-keyword">return</span> <span class="ruby-identifier">sites</span>
        <span class="ruby-keyword">rescue</span> <span class="ruby-constant">Exception</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">ee</span>
                <span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;Exception on method #{__method__}: #{ee}&quot;</span> <span class="ruby-keyword">if</span> <span class="ruby-ivar">@verbose</span>
                <span class="ruby-keyword">return</span> <span class="ruby-keyword">nil</span>
        <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        
        <div class="aliases">
          Also aliased as: <a href="SiteTracker.html#method-i-get_int">get_int</a>
        </div>
        

        
      </div>

    
      <div id="method-i-get_ip_sites" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">get_ip_sites</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Retrieve a list of sites that contain an IP in the site URL</p>
          
          

          
          <div class="method-source-code" id="get_ip_sites-source">
            <pre><span class="ruby-comment"># File lib/wmap/site_tracker.rb, line 549</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">get_ip_sites</span>
        <span class="ruby-identifier">puts</span> <span class="ruby-string">&quot;Getter to retrieve sites contain an IP instead of a host-name .&quot;</span> <span class="ruby-keyword">if</span> <span class="ruby-ivar">@verbose</span>
        <span class="ruby-keyword">begin</span>
                <span class="ruby-identifier">sites</span>=<span class="ruby-constant">Array</span>.<span class="ruby-identifier">new</span>
                <span class="ruby-ivar">@known_sites</span>.<span class="ruby-identifier">keys</span>.<span class="ruby-identifier">map</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">key</span><span class="ruby-operator">|</span>
                        <span class="ruby-identifier">host</span>=<span class="ruby-identifier">url_2_host</span>(<span class="ruby-identifier">key</span>)
                        <span class="ruby-keyword">if</span> <span class="ruby-identifier">is_ip?</span>(<span class="ruby-identifier">host</span>)
                                <span class="ruby-identifier">sites</span>.<span class="ruby-identifier">push</span>(<span class="ruby-identifier">key</span>)
                        <span class="ruby-keyword">end</span>
                <span class="ruby-keyword">end</span>
                <span class="ruby-identifier">sites</span>.<span class="ruby-identifier">sort!</span>
                <span class="ruby-keyword">return</span> <span class="ruby-identifier">sites</span>
        <span class="ruby-keyword">rescue</span> <span class="ruby-constant">Exception</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">ee</span>
                <span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;Exception on method #{__method__}: #{ee}&quot;</span> <span class="ruby-keyword">if</span> <span class="ruby-ivar">@verbose</span>
                <span class="ruby-keyword">return</span> <span class="ruby-keyword">nil</span>
        <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-get_prim_uniq_sites" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">get_prim_uniq_sites</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Retrieve the unique sites from the local site store in the primary host
format</p>
          
          

          
          <div class="method-source-code" id="get_prim_uniq_sites-source">
            <pre><span class="ruby-comment"># File lib/wmap/site_tracker.rb, line 827</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">get_prim_uniq_sites</span>
        <span class="ruby-identifier">puts</span> <span class="ruby-string">&quot;Retrieve and prime unique sites in the site store. &quot;</span> <span class="ruby-keyword">if</span> <span class="ruby-ivar">@verbose</span>
        <span class="ruby-keyword">begin</span>
                <span class="ruby-identifier">host_tracker</span>=<span class="ruby-constant">Wmap</span><span class="ruby-operator">::</span><span class="ruby-constant">HostTracker</span>.<span class="ruby-identifier">instance</span>
                <span class="ruby-identifier">primary_host_tracker</span>=<span class="ruby-constant">Wmap</span><span class="ruby-operator">::</span><span class="ruby-constant">HostTracker</span><span class="ruby-operator">::</span><span class="ruby-constant">PrimaryHost</span>.<span class="ruby-identifier">instance</span>
                <span class="ruby-comment"># Step 1. Retrieve the unique site list first</span>
                <span class="ruby-identifier">sites</span>=<span class="ruby-identifier">get_uniq_sites</span>
                <span class="ruby-identifier">prim_uniq_sites</span>=<span class="ruby-constant">Array</span>.<span class="ruby-identifier">new</span>
                <span class="ruby-comment"># Step 2. Iterate on the unique site list, spit out the site in the primary host format one at a time</span>
                <span class="ruby-identifier">sites</span>.<span class="ruby-identifier">map</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">site</span><span class="ruby-operator">|</span>
                        <span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;Work on priming unique site: #{site}&quot;</span> <span class="ruby-keyword">if</span> <span class="ruby-ivar">@verbose</span>
                        <span class="ruby-identifier">host</span>=<span class="ruby-identifier">url_2_host</span>(<span class="ruby-identifier">site</span>)
                        <span class="ruby-comment"># case#1, for the IP only site, do nothing (presuming &#39;refresh_ip_sites&#39; or &#39;refresh_all&#39; method already take care of the potential discrepancy here). </span>
                        <span class="ruby-keyword">if</span> <span class="ruby-identifier">is_ip?</span>(<span class="ruby-identifier">host</span>)
                                <span class="ruby-identifier">prim_uniq_sites</span>.<span class="ruby-identifier">push</span>(<span class="ruby-identifier">site</span>)
                                <span class="ruby-keyword">next</span>
                        <span class="ruby-keyword">end</span>
                        <span class="ruby-identifier">ip</span>=<span class="ruby-ivar">@known_sites</span>[<span class="ruby-identifier">site</span>][<span class="ruby-string">&#39;ip&#39;</span>]
                        <span class="ruby-comment"># case#2, for site with an unique IP, do nothing</span>
                        <span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;Local hosts table entry count for #{ip}: #{host_tracker.alias[ip]}&quot;</span> <span class="ruby-keyword">if</span> <span class="ruby-ivar">@verbose</span>
                        <span class="ruby-keyword">if</span> <span class="ruby-identifier">host_tracker</span>.<span class="ruby-identifier">alias</span>[<span class="ruby-identifier">ip</span>] <span class="ruby-operator">==</span> <span class="ruby-value">1</span>
                                <span class="ruby-identifier">prim_uniq_sites</span>.<span class="ruby-identifier">push</span>(<span class="ruby-identifier">site</span>)
                                <span class="ruby-keyword">next</span>
                        <span class="ruby-keyword">end</span>
                        <span class="ruby-comment"># case#3, case of multiple IPs for A DNS record, where the site IP may have 0 alias count, do nothing</span>
                        <span class="ruby-keyword">if</span> <span class="ruby-identifier">host_tracker</span>.<span class="ruby-identifier">alias</span>[<span class="ruby-identifier">ip</span>] <span class="ruby-operator">==</span> <span class="ruby-keyword">nil</span>
                                <span class="ruby-identifier">prim_uniq_sites</span>.<span class="ruby-identifier">push</span>(<span class="ruby-identifier">site</span>)
                                <span class="ruby-keyword">next</span>
                        <span class="ruby-keyword">end</span>                 
                        <span class="ruby-comment"># case#4, for the site has a duplicate IP with others, we try to determine which one is the primary site</span>
                        <span class="ruby-comment"># raise &quot;Error: inconsistency detected on record: #{site}. Please run the following shell command to refresh it first: \n\srefresh #{site}&quot; if tracker1.alias[ip].nil?</span>
                        <span class="ruby-keyword">if</span> ( <span class="ruby-identifier">primary_host_tracker</span>.<span class="ruby-identifier">known_hosts</span>.<span class="ruby-identifier">key?</span>(<span class="ruby-identifier">ip</span>) <span class="ruby-keyword">and</span> (<span class="ruby-constant">Wmap</span><span class="ruby-operator">::</span><span class="ruby-constant">HostTracker</span>.<span class="ruby-identifier">instance</span>.<span class="ruby-identifier">alias</span>[<span class="ruby-identifier">ip</span>] <span class="ruby-operator">&gt;</span> <span class="ruby-value">1</span>) )     
                                <span class="ruby-identifier">new_host</span>=<span class="ruby-identifier">primary_host_tracker</span>.<span class="ruby-identifier">prime</span>(<span class="ruby-identifier">host</span>)
                                <span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;Host: #{host}, New host:#{new_host}&quot;</span> <span class="ruby-keyword">if</span> <span class="ruby-ivar">@verbose</span>
                                <span class="ruby-keyword">unless</span> <span class="ruby-identifier">host</span><span class="ruby-operator">==</span><span class="ruby-identifier">new_host</span>
                                        <span class="ruby-identifier">new_site</span>=<span class="ruby-identifier">site</span>.<span class="ruby-identifier">sub</span>(<span class="ruby-identifier">host</span>,<span class="ruby-identifier">new_host</span>) 
                                        <span class="ruby-identifier">raise</span> <span class="ruby-node">&quot;Site not found in the site tracking data repository: #{new_site}. You may need to add it into the site store first. Execute the following shell command before trying again: \n\twadd #{new_site}\n&quot;</span> <span class="ruby-keyword">unless</span> <span class="ruby-ivar">@known_sites</span>.<span class="ruby-identifier">key?</span>(<span class="ruby-identifier">new_site</span>)
                                        <span class="ruby-identifier">new_ip</span>=<span class="ruby-ivar">@known_sites</span>[<span class="ruby-identifier">new_site</span>][<span class="ruby-string">&#39;ip&#39;</span>]
                                        <span class="ruby-keyword">if</span> <span class="ruby-identifier">new_ip</span><span class="ruby-operator">==</span><span class="ruby-identifier">ip</span>             <span class="ruby-comment"># consistency check</span>
                                                <span class="ruby-identifier">site</span>=<span class="ruby-identifier">new_site</span> 
                                        <span class="ruby-keyword">else</span>
                                                <span class="ruby-comment"># TBD - case of multiple IPs for A DNS record </span>
                                                <span class="ruby-comment">#raise &quot;Inconsistency found on prime host entrance: #{new_ip}, #{ip}; #{new_site}, #{site}. Please refresh your entries by running the following shell command: \n\s refresh #{new_site}&quot;</span>
                                        <span class="ruby-keyword">end</span>
                                <span class="ruby-keyword">end</span>
                        <span class="ruby-keyword">end</span>
                        <span class="ruby-identifier">prim_uniq_sites</span>.<span class="ruby-identifier">push</span>(<span class="ruby-identifier">site</span>)
                <span class="ruby-keyword">end</span>
                <span class="ruby-identifier">primary_host_tracker</span>=<span class="ruby-keyword">nil</span>
                <span class="ruby-identifier">host_tracker</span>=<span class="ruby-keyword">nil</span>
                <span class="ruby-keyword">return</span> <span class="ruby-identifier">prim_uniq_sites</span>
        <span class="ruby-keyword">rescue</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">ee</span>
                <span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;Exception on method #{__method__}: #{ee}&quot;</span>
        <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        
        <div class="aliases">
          Also aliased as: <a href="SiteTracker.html#method-i-get_prime">get_prime</a>
        </div>
        

        
      </div>

    
      <div id="method-i-get_prime" class="method-detail method-alias">
        
        <div class="method-heading">
          <span class="method-name">get_prime</span><span
            class="method-args">()</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
        </div>

        

        
        <div class="aliases">
          Alias for: <a href="SiteTracker.html#method-i-get_prim_uniq_sites">get_prim_uniq_sites</a>
        </div>
        
      </div>

    
      <div id="method-i-get_redirection_url" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">get_redirection_url</span><span
            class="method-args">(site)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Retrieve redirection URL if available</p>
          
          

          
          <div class="method-source-code" id="get_redirection_url-source">
            <pre><span class="ruby-comment"># File lib/wmap/site_tracker.rb, line 650</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">get_redirection_url</span> (<span class="ruby-identifier">site</span>)
        <span class="ruby-identifier">puts</span> <span class="ruby-string">&quot;getter to retrieve the redirection URL from the site store.&quot;</span> <span class="ruby-keyword">if</span> <span class="ruby-ivar">@verbose</span>
        <span class="ruby-keyword">begin</span>
                <span class="ruby-identifier">site</span>=<span class="ruby-identifier">site</span>.<span class="ruby-identifier">strip</span>.<span class="ruby-identifier">downcase</span>
                <span class="ruby-keyword">if</span> <span class="ruby-ivar">@known_sites</span>.<span class="ruby-identifier">key?</span>(<span class="ruby-identifier">site</span>)
                        <span class="ruby-keyword">return</span> <span class="ruby-ivar">@known_sites</span>[<span class="ruby-identifier">site</span>][<span class="ruby-string">&#39;redirection&#39;</span>]
                <span class="ruby-keyword">else</span>
                        <span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;Unknown site: #{site}&quot;</span> <span class="ruby-keyword">if</span> <span class="ruby-ivar">@verbose</span>
                        <span class="ruby-keyword">return</span> <span class="ruby-keyword">nil</span>
                <span class="ruby-keyword">end</span>
        <span class="ruby-keyword">rescue</span> <span class="ruby-constant">Exception</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">ee</span>
                <span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;Exception on method #{__method__}: #{ee}&quot;</span> <span class="ruby-keyword">if</span> <span class="ruby-ivar">@verbose</span>
                <span class="ruby-keyword">return</span> <span class="ruby-keyword">nil</span>
        <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-get_redirection_urls" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">get_redirection_urls</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Retrieve a list of redirection URLs from the site store</p>
          
          

          
          <div class="method-source-code" id="get_redirection_urls-source">
            <pre><span class="ruby-comment"># File lib/wmap/site_tracker.rb, line 632</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">get_redirection_urls</span>
        <span class="ruby-identifier">puts</span> <span class="ruby-string">&quot;getter to retrieve all the redirection URLs from the site store.&quot;</span> <span class="ruby-keyword">if</span> <span class="ruby-ivar">@verbose</span>
        <span class="ruby-keyword">begin</span>
                <span class="ruby-identifier">urls</span>=<span class="ruby-constant">Array</span>.<span class="ruby-identifier">new</span>
                <span class="ruby-ivar">@known_sites</span>.<span class="ruby-identifier">keys</span>.<span class="ruby-identifier">map</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">key</span><span class="ruby-operator">|</span>
                        <span class="ruby-keyword">unless</span> <span class="ruby-ivar">@known_sites</span>[<span class="ruby-identifier">key</span>][<span class="ruby-string">&#39;redirection&#39;</span>].<span class="ruby-identifier">nil?</span>
                                <span class="ruby-identifier">urls</span>.<span class="ruby-identifier">push</span>(<span class="ruby-ivar">@known_sites</span>[<span class="ruby-identifier">key</span>][<span class="ruby-string">&#39;redirection&#39;</span>])
                        <span class="ruby-keyword">end</span>
                <span class="ruby-keyword">end</span>
                <span class="ruby-identifier">urls</span>.<span class="ruby-identifier">sort!</span>
                <span class="ruby-keyword">return</span> <span class="ruby-identifier">urls</span>
        <span class="ruby-keyword">rescue</span> <span class="ruby-constant">Exception</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">ee</span>
                <span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;Exception on method #{__method__}: #{ee}&quot;</span> <span class="ruby-keyword">if</span> <span class="ruby-ivar">@verbose</span>
                <span class="ruby-keyword">return</span> <span class="ruby-keyword">nil</span>
        <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-get_ssl_sites" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">get_ssl_sites</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Retrieve a list of sites that contain an IP in the site URL</p>
          
          

          
          <div class="method-source-code" id="get_ssl_sites-source">
            <pre><span class="ruby-comment"># File lib/wmap/site_tracker.rb, line 615</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">get_ssl_sites</span>
        <span class="ruby-identifier">puts</span> <span class="ruby-string">&quot;getter to retrieve https sites from the site store.&quot;</span> <span class="ruby-keyword">if</span> <span class="ruby-ivar">@verbose</span>
        <span class="ruby-keyword">begin</span>
                <span class="ruby-identifier">sites</span>=<span class="ruby-constant">Array</span>.<span class="ruby-identifier">new</span>
                <span class="ruby-ivar">@known_sites</span>.<span class="ruby-identifier">keys</span>.<span class="ruby-identifier">map</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">key</span><span class="ruby-operator">|</span>
                        <span class="ruby-identifier">key</span> <span class="ruby-operator">=~</span> <span class="ruby-regexp">/https/i</span> 
                        <span class="ruby-identifier">sites</span>.<span class="ruby-identifier">push</span>(<span class="ruby-identifier">key</span>)
                <span class="ruby-keyword">end</span>
                <span class="ruby-identifier">sites</span>.<span class="ruby-identifier">sort!</span>
                <span class="ruby-keyword">return</span> <span class="ruby-identifier">sites</span>
        <span class="ruby-keyword">rescue</span> <span class="ruby-constant">Exception</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">ee</span>
                <span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;Exception on method #{__method__}: #{ee}&quot;</span> <span class="ruby-keyword">if</span> <span class="ruby-ivar">@verbose</span>
                <span class="ruby-keyword">return</span> <span class="ruby-keyword">nil</span>
        <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-get_uniq_sites" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">get_uniq_sites</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Retrieve a list of unique sites within the known site store</p>
          
          

          
          <div class="method-source-code" id="get_uniq_sites-source">
            <pre><span class="ruby-comment"># File lib/wmap/site_tracker.rb, line 568</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">get_uniq_sites</span>
        <span class="ruby-identifier">puts</span> <span class="ruby-string">&quot;Getter to retrieve unique sites containing unique IP:PORT key identifier.&quot;</span> <span class="ruby-keyword">if</span> <span class="ruby-ivar">@verbose</span>
        <span class="ruby-keyword">begin</span>
                <span class="ruby-comment">#primary_host_tracker=Wmap::HostTracker::PrimaryHost.new</span>
                <span class="ruby-identifier">sites</span>=<span class="ruby-constant">Hash</span>.<span class="ruby-identifier">new</span>
                <span class="ruby-comment">#uniqueness=Hash.new</span>
                <span class="ruby-ivar">@known_sites</span>.<span class="ruby-identifier">keys</span>.<span class="ruby-identifier">map</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">key</span><span class="ruby-operator">|</span>
                        <span class="ruby-identifier">port</span>=<span class="ruby-identifier">url_2_port</span>(<span class="ruby-identifier">key</span>).<span class="ruby-identifier">to_s</span>
                        <span class="ruby-identifier">host</span>=<span class="ruby-identifier">url_2_host</span>(<span class="ruby-identifier">key</span>)
                        <span class="ruby-identifier">md5</span>=<span class="ruby-ivar">@known_sites</span>[<span class="ruby-identifier">key</span>][<span class="ruby-string">&#39;md5&#39;</span>]
                        <span class="ruby-identifier">code</span>=<span class="ruby-ivar">@known_sites</span>[<span class="ruby-identifier">key</span>][<span class="ruby-string">&#39;code&#39;</span>]
                        <span class="ruby-identifier">ip</span>=<span class="ruby-constant">Wmap</span><span class="ruby-operator">::</span><span class="ruby-constant">HostTracker</span>.<span class="ruby-identifier">instance</span>.<span class="ruby-identifier">local_host_2_ip</span>(<span class="ruby-identifier">host</span>)
                        <span class="ruby-identifier">ip</span>=<span class="ruby-identifier">host_2_ip</span>(<span class="ruby-identifier">host</span>) <span class="ruby-keyword">if</span> <span class="ruby-identifier">ip</span>.<span class="ruby-identifier">nil?</span>
                        <span class="ruby-comment"># filtering out &#39;un-reachable&#39; sites</span>
                        <span class="ruby-keyword">next</span> <span class="ruby-keyword">if</span> (<span class="ruby-identifier">code</span> <span class="ruby-operator">==</span> <span class="ruby-value">10000</span> <span class="ruby-keyword">or</span> <span class="ruby-identifier">code</span> <span class="ruby-operator">==</span> <span class="ruby-value">20000</span>)
                        <span class="ruby-comment"># filtering out &#39;empty&#39; sites</span>
                        <span class="ruby-keyword">next</span> <span class="ruby-keyword">if</span> (<span class="ruby-identifier">md5</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-keyword">or</span> <span class="ruby-identifier">md5</span>.<span class="ruby-identifier">empty?</span>)
                        <span class="ruby-keyword">next</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">ip</span>.<span class="ruby-identifier">nil?</span>
                        <span class="ruby-comment"># url_new=key</span>
                        <span class="ruby-comment">#if primary_host_tracker.ip_known?(ip)</span>
                        <span class="ruby-comment">#   p_host=primary_host_tracker.known_hosts[ip]</span>
                        <span class="ruby-comment">#   url_new=key.sub(host,p_host)</span>
                        <span class="ruby-comment">#end</span>
                        <span class="ruby-identifier">id</span>=<span class="ruby-identifier">ip</span><span class="ruby-operator">+</span><span class="ruby-string">&quot;:&quot;</span><span class="ruby-operator">+</span><span class="ruby-identifier">port</span>
                        <span class="ruby-comment"># filtering out duplicates by &#39;IP:PORT&#39; key pair</span>
                        <span class="ruby-keyword">unless</span> <span class="ruby-identifier">sites</span>.<span class="ruby-identifier">key?</span>(<span class="ruby-identifier">id</span>)
                                <span class="ruby-comment">#if @known_sites.key?(key)</span>
                                <span class="ruby-comment">#  sites[id]=url_new</span>
                                <span class="ruby-comment">#else</span>
                                        <span class="ruby-comment"># Further filtering out redundant site by checking MD5 finger-print</span>
                                        <span class="ruby-comment">#unless uniqueness.key?(md5)</span>
                                                <span class="ruby-identifier">sites</span>[<span class="ruby-identifier">id</span>]=<span class="ruby-identifier">key</span>
                                        <span class="ruby-comment"># uniqueness[md5]=true</span>
                                        <span class="ruby-comment">#end</span>
                                <span class="ruby-comment">#end </span>
                        <span class="ruby-keyword">end</span>
                <span class="ruby-keyword">end</span>
                <span class="ruby-comment">#primary_host_tracker=nil</span>
                <span class="ruby-keyword">return</span> <span class="ruby-identifier">sites</span>.<span class="ruby-identifier">values</span>
        <span class="ruby-keyword">rescue</span> <span class="ruby-constant">Exception</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">ee</span>
                <span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;Exception on method #{__method__}: #{ee}&quot;</span> <span class="ruby-keyword">if</span> <span class="ruby-ivar">@verbose</span>
                <span class="ruby-keyword">return</span> <span class="ruby-keyword">nil</span>
        <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        
        <div class="aliases">
          Also aliased as: <a href="SiteTracker.html#method-i-uniq_sites">uniq_sites</a>
        </div>
        

        
      </div>

    
      <div id="method-i-is_known-3F" class="method-detail method-alias">
        
        <div class="method-heading">
          <span class="method-name">is_known?</span><span
            class="method-args">(site)</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
        </div>

        

        
        <div class="aliases">
          Alias for: <a href="SiteTracker.html#method-i-site_known-3F">site_known?</a>
        </div>
        
      </div>

    
      <div id="method-i-load_site_stores_from_file" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">load_site_stores_from_file</span><span
            class="method-args">(file)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Setter to load the known hosts into an instance variable</p>
          
          

          
          <div class="method-source-code" id="load_site_stores_from_file-source">
            <pre><span class="ruby-comment"># File lib/wmap/site_tracker.rb, line 33</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">load_site_stores_from_file</span> (<span class="ruby-identifier">file</span>)
        <span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;Loading the site store data repository from file: #{file} &quot;</span> <span class="ruby-keyword">if</span> <span class="ruby-ivar">@verbose</span>
        <span class="ruby-keyword">begin</span>
                <span class="ruby-identifier">known_sites</span>=<span class="ruby-constant">Hash</span>.<span class="ruby-identifier">new</span>
                <span class="ruby-identifier">f</span>=<span class="ruby-constant">File</span>.<span class="ruby-identifier">open</span>(<span class="ruby-identifier">file</span>, <span class="ruby-string">&#39;r&#39;</span>)
                <span class="ruby-identifier">f</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">line</span><span class="ruby-operator">|</span>
                        <span class="ruby-identifier">line</span>=<span class="ruby-identifier">line</span>.<span class="ruby-identifier">chomp</span>.<span class="ruby-identifier">strip</span>
                        <span class="ruby-keyword">next</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">line</span>.<span class="ruby-identifier">nil?</span>
                        <span class="ruby-keyword">next</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">line</span>.<span class="ruby-identifier">empty?</span>
                        <span class="ruby-keyword">next</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">line</span> <span class="ruby-operator">=~</span> <span class="ruby-node">/^\s*#/</span> 
                        <span class="ruby-identifier">entry</span>=<span class="ruby-identifier">line</span>.<span class="ruby-identifier">split</span>(<span class="ruby-regexp">%r{\t+|\,}</span>)
                        <span class="ruby-identifier">site</span>=<span class="ruby-identifier">entry</span>[<span class="ruby-value">0</span>].<span class="ruby-identifier">downcase</span>
                        <span class="ruby-identifier">ip</span>=<span class="ruby-identifier">entry</span>[<span class="ruby-value">1</span>]
                        <span class="ruby-identifier">port</span>=<span class="ruby-identifier">entry</span>[<span class="ruby-value">2</span>]
                        <span class="ruby-identifier">status</span>=<span class="ruby-identifier">entry</span>[<span class="ruby-value">3</span>]
                        <span class="ruby-identifier">server</span>=<span class="ruby-identifier">entry</span>[<span class="ruby-value">4</span>]
                        <span class="ruby-identifier">res</span>=<span class="ruby-identifier">entry</span>[<span class="ruby-value">5</span>].<span class="ruby-identifier">to_i</span>
                        <span class="ruby-identifier">fp</span>=<span class="ruby-identifier">entry</span>[<span class="ruby-value">6</span>]
                        <span class="ruby-identifier">loc</span>=<span class="ruby-identifier">entry</span>[<span class="ruby-value">7</span>]
                        <span class="ruby-identifier">timestamp</span>=<span class="ruby-identifier">entry</span>[<span class="ruby-value">8</span>]
                        <span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;Loading entry: #{site} - #{ip} - #{status}&quot;</span> <span class="ruby-keyword">if</span> <span class="ruby-ivar">@verbose</span>
                        <span class="ruby-identifier">known_sites</span>[<span class="ruby-identifier">site</span>]= <span class="ruby-constant">Hash</span>.<span class="ruby-identifier">new</span> <span class="ruby-keyword">unless</span> <span class="ruby-identifier">known_sites</span>.<span class="ruby-identifier">key?</span>(<span class="ruby-identifier">site</span>)
                        <span class="ruby-identifier">known_sites</span>[<span class="ruby-identifier">site</span>][<span class="ruby-string">&#39;ip&#39;</span>]=<span class="ruby-identifier">ip</span>
                        <span class="ruby-identifier">known_sites</span>[<span class="ruby-identifier">site</span>][<span class="ruby-string">&#39;port&#39;</span>]=<span class="ruby-identifier">port</span>
                        <span class="ruby-identifier">known_sites</span>[<span class="ruby-identifier">site</span>][<span class="ruby-string">&#39;status&#39;</span>]=<span class="ruby-identifier">status</span>
                        <span class="ruby-identifier">known_sites</span>[<span class="ruby-identifier">site</span>][<span class="ruby-string">&#39;server&#39;</span>]=<span class="ruby-identifier">server</span>
                        <span class="ruby-identifier">known_sites</span>[<span class="ruby-identifier">site</span>][<span class="ruby-string">&#39;code&#39;</span>]=<span class="ruby-identifier">res</span>
                        <span class="ruby-identifier">known_sites</span>[<span class="ruby-identifier">site</span>][<span class="ruby-string">&#39;md5&#39;</span>]=<span class="ruby-identifier">fp</span>
                        <span class="ruby-identifier">known_sites</span>[<span class="ruby-identifier">site</span>][<span class="ruby-string">&#39;redirection&#39;</span>]=<span class="ruby-identifier">loc</span>
                        <span class="ruby-identifier">known_sites</span>[<span class="ruby-identifier">site</span>][<span class="ruby-string">&#39;timestamp&#39;</span>]=<span class="ruby-identifier">timestamp</span>                            
                <span class="ruby-keyword">end</span>
                <span class="ruby-identifier">f</span>.<span class="ruby-identifier">close</span>
                <span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;Successfully loading file: #{file}&quot;</span> <span class="ruby-keyword">if</span> <span class="ruby-ivar">@verbose</span>
                <span class="ruby-keyword">return</span> <span class="ruby-identifier">known_sites</span>
        <span class="ruby-keyword">rescue</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">ee</span>                  
                <span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;Exception on method #{__method__} for file #{file}: #{ee}&quot;</span>
        <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-print" class="method-detail method-alias">
        
        <div class="method-heading">
          <span class="method-name">print</span><span
            class="method-args">(site)</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
        </div>

        

        
        <div class="aliases">
          Alias for: <a href="SiteTracker.html#method-i-print_site">print_site</a>
        </div>
        
      </div>

    
      <div id="method-i-print_all" class="method-detail method-alias">
        
        <div class="method-heading">
          <span class="method-name">print_all</span><span
            class="method-args">()</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
        </div>

        

        
        <div class="aliases">
          Alias for: <a href="SiteTracker.html#method-i-print_all_sites">print_all_sites</a>
        </div>
        
      </div>

    
      <div id="method-i-print_all_sites" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">print_all_sites</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Print summary report of all sites URL in the site store</p>
          
          

          
          <div class="method-source-code" id="print_all_sites-source">
            <pre><span class="ruby-comment"># File lib/wmap/site_tracker.rb, line 741</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">print_all_sites</span>
        <span class="ruby-identifier">puts</span> <span class="ruby-string">&quot;\nSummary Report of the site store:&quot;</span>
        <span class="ruby-identifier">sites</span>=<span class="ruby-ivar">@known_sites</span>.<span class="ruby-identifier">keys</span>.<span class="ruby-identifier">sort</span>
        <span class="ruby-identifier">sites</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">site</span><span class="ruby-operator">|</span>
                <span class="ruby-identifier">puts</span> <span class="ruby-identifier">site</span>            
        <span class="ruby-keyword">end</span>
        
        <span class="ruby-identifier">puts</span> <span class="ruby-string">&quot;End of the summary&quot;</span>
        <span class="ruby-comment">#return sites</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        
        <div class="aliases">
          Also aliased as: <a href="SiteTracker.html#method-i-print_all">print_all</a>
        </div>
        

        
      </div>

    
      <div id="method-i-print_ext" class="method-detail method-alias">
        
        <div class="method-heading">
          <span class="method-name">print_ext</span><span
            class="method-args">()</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
        </div>

        

        
        <div class="aliases">
          Alias for: <a href="SiteTracker.html#method-i-print_ext_sites">print_ext_sites</a>
        </div>
        
      </div>

    
      <div id="method-i-print_ext_sites" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">print_ext_sites</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Print summary report of external hosted sites URL in the</p>
          
          

          
          <div class="method-source-code" id="print_ext_sites-source">
            <pre><span class="ruby-comment"># File lib/wmap/site_tracker.rb, line 885</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">print_ext_sites</span>
        <span class="ruby-identifier">puts</span> <span class="ruby-string">&quot;\nSummary Report of the External Hosted Site&quot;</span>
        <span class="ruby-identifier">sites</span>=<span class="ruby-identifier">get_ext_sites</span>
        <span class="ruby-identifier">sites</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">site</span><span class="ruby-operator">|</span>
                <span class="ruby-identifier">puts</span> <span class="ruby-identifier">site</span>
        <span class="ruby-keyword">end</span>
        <span class="ruby-keyword">return</span> <span class="ruby-keyword">nil</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        
        <div class="aliases">
          Also aliased as: <a href="SiteTracker.html#method-i-print_ext">print_ext</a>
        </div>
        

        
      </div>

    
      <div id="method-i-print_int" class="method-detail method-alias">
        
        <div class="method-heading">
          <span class="method-name">print_int</span><span
            class="method-args">()</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
        </div>

        

        
        <div class="aliases">
          Alias for: <a href="SiteTracker.html#method-i-print_int_sites">print_int_sites</a>
        </div>
        
      </div>

    
      <div id="method-i-print_int_sites" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">print_int_sites</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Print summary report of internal hosted site URLs</p>
          
          

          
          <div class="method-source-code" id="print_int_sites-source">
            <pre><span class="ruby-comment"># File lib/wmap/site_tracker.rb, line 896</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">print_int_sites</span>
        <span class="ruby-identifier">puts</span> <span class="ruby-string">&quot;\nSummary Report of the Internal Hosted Site&quot;</span>
        <span class="ruby-identifier">sites</span>=<span class="ruby-identifier">get_int_sites</span>
        <span class="ruby-identifier">sites</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">site</span><span class="ruby-operator">|</span>
                <span class="ruby-identifier">puts</span> <span class="ruby-identifier">site</span>
        <span class="ruby-keyword">end</span>
        <span class="ruby-keyword">return</span> <span class="ruby-keyword">nil</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        
        <div class="aliases">
          Also aliased as: <a href="SiteTracker.html#method-i-print_int">print_int</a>
        </div>
        

        
      </div>

    
      <div id="method-i-print_ip_sites" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">print_ip_sites</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Print summary report on all sites that contain an IP in the site URL</p>
          
          

          
          <div class="method-source-code" id="print_ip_sites-source">
            <pre><span class="ruby-comment"># File lib/wmap/site_tracker.rb, line 711</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">print_ip_sites</span>
        <span class="ruby-identifier">puts</span> <span class="ruby-string">&quot;Print sites contain an IP instead of a host-name.&quot;</span> 
        <span class="ruby-identifier">sites</span>=<span class="ruby-identifier">get_ip_sites</span>
        <span class="ruby-identifier">sites</span>.<span class="ruby-identifier">map</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">x</span><span class="ruby-operator">|</span> <span class="ruby-identifier">puts</span> <span class="ruby-identifier">x</span> }
        <span class="ruby-identifier">puts</span> <span class="ruby-string">&quot;End of report. &quot;</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-print_site" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">print_site</span><span
            class="method-args">(site)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Retrieve and print specific information of a site in the site store</p>
          
          

          
          <div class="method-source-code" id="print_site-source">
            <pre><span class="ruby-comment"># File lib/wmap/site_tracker.rb, line 719</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">print_site</span>(<span class="ruby-identifier">site</span>)
        <span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;Site Information Report for: #{site}&quot;</span> <span class="ruby-keyword">if</span> <span class="ruby-ivar">@verbose</span>
        <span class="ruby-keyword">begin</span>
                <span class="ruby-identifier">site</span>=<span class="ruby-identifier">site</span>.<span class="ruby-identifier">strip</span> <span class="ruby-keyword">unless</span> <span class="ruby-identifier">site</span>.<span class="ruby-identifier">nil?</span>
                <span class="ruby-identifier">raise</span> <span class="ruby-node">&quot;Unknown site: #{site}&quot;</span> <span class="ruby-keyword">unless</span> <span class="ruby-ivar">@known_sites</span>.<span class="ruby-identifier">key?</span>(<span class="ruby-identifier">site</span>)
                <span class="ruby-identifier">ip</span>=<span class="ruby-ivar">@known_sites</span>[<span class="ruby-identifier">site</span>][<span class="ruby-string">&#39;ip&#39;</span>]
                <span class="ruby-identifier">port</span>=<span class="ruby-ivar">@known_sites</span>[<span class="ruby-identifier">site</span>][<span class="ruby-string">&#39;port&#39;</span>]
                <span class="ruby-identifier">status</span>=<span class="ruby-ivar">@known_sites</span>[<span class="ruby-identifier">site</span>][<span class="ruby-string">&#39;status&#39;</span>]
                <span class="ruby-identifier">server</span>=<span class="ruby-ivar">@known_sites</span>[<span class="ruby-identifier">site</span>][<span class="ruby-string">&#39;server&#39;</span>]
                <span class="ruby-identifier">fp</span>=<span class="ruby-ivar">@known_sites</span>[<span class="ruby-identifier">site</span>][<span class="ruby-string">&#39;md5&#39;</span>]
                <span class="ruby-identifier">loc</span>=<span class="ruby-ivar">@known_sites</span>[<span class="ruby-identifier">site</span>][<span class="ruby-string">&#39;redirection&#39;</span>]
                <span class="ruby-identifier">res</span>=<span class="ruby-ivar">@known_sites</span>[<span class="ruby-identifier">site</span>][<span class="ruby-string">&#39;code&#39;</span>]
                <span class="ruby-identifier">timestamp</span>=<span class="ruby-ivar">@known_sites</span>[<span class="ruby-identifier">site</span>][<span class="ruby-string">&#39;timestamp&#39;</span>]
                <span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;#{site},#{ip},#{port},#{status},#{server},#{res},#{fp},#{loc},#{timestamp}&quot;</span>
        <span class="ruby-keyword">rescue</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">ee</span>
                <span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;Exception on method #{__method__} for #{site}: #{ee}&quot;</span>
        <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        
        <div class="aliases">
          Also aliased as: <a href="SiteTracker.html#method-i-print">print</a>
        </div>
        

        
      </div>

    
      <div id="method-i-print_ssl_sites" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">print_ssl_sites</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Print summary report of internal hosted site URLs</p>
          
          

          
          <div class="method-source-code" id="print_ssl_sites-source">
            <pre><span class="ruby-comment"># File lib/wmap/site_tracker.rb, line 907</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">print_ssl_sites</span>
        <span class="ruby-identifier">puts</span> <span class="ruby-string">&quot;\nSummary Report of the HTTPS Sites from the Site Store&quot;</span>
        <span class="ruby-identifier">sites</span>=<span class="ruby-identifier">get_ssl_sites</span>
        <span class="ruby-identifier">sites</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">site</span><span class="ruby-operator">|</span>
                <span class="ruby-identifier">puts</span> <span class="ruby-identifier">site</span>
        <span class="ruby-keyword">end</span>
        <span class="ruby-keyword">return</span> <span class="ruby-keyword">nil</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-print_uniq_sites" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">print_uniq_sites</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Print summary report of unique sites in the site store</p>
          
          

          
          <div class="method-source-code" id="print_uniq_sites-source">
            <pre><span class="ruby-comment"># File lib/wmap/site_tracker.rb, line 917</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">print_uniq_sites</span>
        <span class="ruby-identifier">puts</span> <span class="ruby-string">&quot;Summary Report for the Unique sites:&quot;</span>
        <span class="ruby-identifier">puts</span> <span class="ruby-string">&quot;Website,Primary IP,Port,Hosting Status,Server,Response Code,Site MD5 Finger-print,Site Redirection,Timestamp&quot;</span>
        <span class="ruby-identifier">sites</span>=<span class="ruby-identifier">get_uniq_sites</span>
        <span class="ruby-identifier">sites</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">site</span><span class="ruby-operator">|</span>
                <span class="ruby-identifier">print_site</span>(<span class="ruby-identifier">site</span>)             
        <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-refresh" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">refresh</span><span
            class="method-args">(site)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Setter to refresh the entry in the site store one at a time</p>
          
          

          
          <div class="method-source-code" id="refresh-source">
            <pre><span class="ruby-comment"># File lib/wmap/site_tracker.rb, line 346</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">refresh</span>(<span class="ruby-identifier">site</span>)
        <span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;Refresh the local site store for site: #{site} &quot;</span> 
        <span class="ruby-keyword">begin</span>
                <span class="ruby-identifier">raise</span> <span class="ruby-node">&quot;Invalid site: #{site}&quot;</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">site</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-keyword">or</span> <span class="ruby-identifier">site</span>.<span class="ruby-identifier">empty?</span>
                <span class="ruby-identifier">site</span>=<span class="ruby-identifier">site</span>.<span class="ruby-identifier">strip</span>.<span class="ruby-identifier">downcase</span>
                <span class="ruby-keyword">if</span> <span class="ruby-ivar">@known_sites</span>.<span class="ruby-identifier">key?</span>(<span class="ruby-identifier">site</span>)
                        <span class="ruby-identifier">delete</span>(<span class="ruby-identifier">site</span>)
                        <span class="ruby-identifier">site_info</span>=<span class="ruby-identifier">add</span>(<span class="ruby-identifier">site</span>)
                        <span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;Done refresh entry: #{site}&quot;</span>
                        <span class="ruby-keyword">return</span> <span class="ruby-identifier">site_info</span>
                <span class="ruby-keyword">else</span>
                        <span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;Error entry non exist: #{site}&quot;</span>
                <span class="ruby-keyword">end</span>
                <span class="ruby-keyword">return</span> <span class="ruby-keyword">nil</span>
        <span class="ruby-keyword">rescue</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">ee</span>                  
                <span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;Exception on method #{__method__}: #{ee}&quot;</span> <span class="ruby-keyword">if</span> <span class="ruby-ivar">@verbose</span>
                <span class="ruby-keyword">return</span> <span class="ruby-keyword">nil</span>
        <span class="ruby-keyword">end</span>           
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-refresh_all" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">refresh_all</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Refresh all site entries in the stores in one shot</p>
          
          

          
          <div class="method-source-code" id="refresh_all-source">
            <pre><span class="ruby-comment"># File lib/wmap/site_tracker.rb, line 432</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">refresh_all</span>
        <span class="ruby-identifier">puts</span> <span class="ruby-string">&quot;Refresh all the entries within the local site store ... &quot;</span> 
        <span class="ruby-keyword">begin</span>
                <span class="ruby-identifier">changes</span>=<span class="ruby-constant">Hash</span>.<span class="ruby-identifier">new</span>
                <span class="ruby-identifier">changes</span>=<span class="ruby-identifier">bulk_refresh</span>(<span class="ruby-ivar">@known_sites</span>.<span class="ruby-identifier">keys</span>)
                <span class="ruby-ivar">@known_sites</span>.<span class="ruby-identifier">merge!</span>(<span class="ruby-identifier">changes</span>)
                <span class="ruby-identifier">puts</span> <span class="ruby-string">&quot;Done refresh all entries.&quot;</span>
                <span class="ruby-keyword">return</span> <span class="ruby-identifier">changes</span>
        <span class="ruby-keyword">rescue</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">ee</span>                  
                <span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;Exception on method #{__method__}: #{ee}&quot;</span> <span class="ruby-keyword">if</span> <span class="ruby-ivar">@verbose</span>
        <span class="ruby-keyword">end</span>           
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-refresh_ip_sites" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">refresh_ip_sites</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Refresh all site entries in the stores that contains an IP instead of a
hostname</p>
          
          

          
          <div class="method-source-code" id="refresh_ip_sites-source">
            <pre><span class="ruby-comment"># File lib/wmap/site_tracker.rb, line 446</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">refresh_ip_sites</span>
        <span class="ruby-identifier">puts</span> <span class="ruby-string">&quot;Refresh all entries that contain an IP address instead of a FQDN ... &quot;</span> 
        <span class="ruby-keyword">begin</span>
                <span class="ruby-identifier">sites</span>=<span class="ruby-identifier">get_ip_sites</span>
                <span class="ruby-identifier">live_sites</span>=<span class="ruby-identifier">sites</span>.<span class="ruby-identifier">delete_if</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">x</span><span class="ruby-operator">|</span> <span class="ruby-ivar">@known_sites</span>[<span class="ruby-identifier">x</span>][<span class="ruby-string">&#39;code&#39;</span>] <span class="ruby-operator">==</span> <span class="ruby-value">10000</span> <span class="ruby-keyword">or</span>  <span class="ruby-ivar">@known_sites</span>[<span class="ruby-identifier">x</span>][<span class="ruby-string">&#39;code&#39;</span>] <span class="ruby-operator">==</span> <span class="ruby-value">20000</span> }
                <span class="ruby-identifier">changes</span>=<span class="ruby-constant">Hash</span>.<span class="ruby-identifier">new</span>
                <span class="ruby-identifier">changes</span>=<span class="ruby-identifier">bulk_refresh</span>(<span class="ruby-identifier">live_sites</span>)
                <span class="ruby-ivar">@known_sites</span>.<span class="ruby-identifier">merge!</span>(<span class="ruby-identifier">changes</span>)
                <span class="ruby-identifier">puts</span> <span class="ruby-string">&quot;Done refresh IP sites.&quot;</span>
                <span class="ruby-keyword">return</span> <span class="ruby-identifier">changes</span>
        <span class="ruby-keyword">rescue</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">ee</span>                  
                <span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;Exception on method #{__method__}: #{ee}&quot;</span> <span class="ruby-keyword">if</span> <span class="ruby-ivar">@verbose</span>
        <span class="ruby-keyword">end</span>           
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-refresh_uniq_sites" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">refresh_uniq_sites</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>&#39;Refresh unique sites in the site store only</p>
          
          

          
          <div class="method-source-code" id="refresh_uniq_sites-source">
            <pre><span class="ruby-comment"># File lib/wmap/site_tracker.rb, line 380</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">refresh_uniq_sites</span> 
        <span class="ruby-identifier">puts</span> <span class="ruby-string">&quot;Refresh unique site entries in the site store. &quot;</span> <span class="ruby-keyword">if</span> <span class="ruby-ivar">@verbose</span>
        <span class="ruby-keyword">begin</span>
                <span class="ruby-identifier">changes</span>=<span class="ruby-constant">Hash</span>.<span class="ruby-identifier">new</span>
                <span class="ruby-identifier">sites</span>=<span class="ruby-identifier">get_uniq_sites</span>         
                <span class="ruby-keyword">if</span> <span class="ruby-identifier">sites</span>.<span class="ruby-identifier">size</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span>
                        <span class="ruby-identifier">changes</span>=<span class="ruby-identifier">bulk_refresh</span>(<span class="ruby-identifier">sites</span>)
                <span class="ruby-keyword">else</span>
                        <span class="ruby-identifier">puts</span> <span class="ruby-string">&quot;Error: no entry is refreshed. Please check your site store and try again.&quot;</span>
                <span class="ruby-keyword">end</span>
                <span class="ruby-keyword">return</span> <span class="ruby-identifier">changes</span>
        <span class="ruby-keyword">rescue</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">ee</span>                  
                <span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;Exception on method #{__method__}: #{ee}&quot;</span> <span class="ruby-keyword">if</span> <span class="ruby-ivar">@verbose</span>
        <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-refreshs" class="method-detail method-alias">
        
        <div class="method-heading">
          <span class="method-name">refreshs</span><span
            class="method-args">(list,num=@max_parallel)</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
        </div>

        

        
        <div class="aliases">
          Alias for: <a href="SiteTracker.html#method-i-bulk_refresh">bulk_refresh</a>
        </div>
        
      </div>

    
      <div id="method-i-resolve_ip_sites" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">resolve_ip_sites</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Perform local host table reverse lookup for the IP sites, in hope that the
hostname could now be resolved since the site was discovered</p>
          
          

          
          <div class="method-source-code" id="resolve_ip_sites-source">
            <pre><span class="ruby-comment"># File lib/wmap/site_tracker.rb, line 667</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">resolve_ip_sites</span>
        <span class="ruby-identifier">puts</span> <span class="ruby-string">&quot;Resolve sites that contain an IP address. Update the site cache table once a hostname is found in the local host table.&quot;</span> <span class="ruby-keyword">if</span> <span class="ruby-ivar">@verbose</span>
        <span class="ruby-keyword">begin</span>
                <span class="ruby-identifier">updates</span>=<span class="ruby-constant">Array</span>.<span class="ruby-identifier">new</span>
                <span class="ruby-identifier">sites</span>=<span class="ruby-identifier">get_ip_sites</span>
                <span class="ruby-identifier">sites</span>.<span class="ruby-identifier">map</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">site</span><span class="ruby-operator">|</span>
                        <span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;Work on resolve the IP site: #{site}&quot;</span> <span class="ruby-keyword">if</span> <span class="ruby-ivar">@verbose</span>
                        <span class="ruby-identifier">ip</span>=<span class="ruby-identifier">url_2_host</span>(<span class="ruby-identifier">site</span>)
                        <span class="ruby-identifier">hostname</span>=<span class="ruby-constant">Wmap</span><span class="ruby-operator">::</span><span class="ruby-constant">HostTracker</span>.<span class="ruby-identifier">instance</span>.<span class="ruby-identifier">local_ip_2_host</span>(<span class="ruby-identifier">ip</span>)
                        <span class="ruby-keyword">if</span> <span class="ruby-identifier">hostname</span>.<span class="ruby-identifier">nil?</span>
                                <span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;Can&#39;t resolve #{ip} from the local host store. Skip #{site}&quot;</span> <span class="ruby-keyword">if</span> <span class="ruby-ivar">@verbose</span>
                        <span class="ruby-keyword">else</span>
                                <span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;Host-name found for IP #{ip}: #{hostname}&quot;</span> <span class="ruby-keyword">if</span> <span class="ruby-ivar">@verbose</span>
                                <span class="ruby-identifier">updates</span>.<span class="ruby-identifier">push</span>(<span class="ruby-identifier">site</span>)
                                <span class="ruby-identifier">refresh</span>(<span class="ruby-identifier">site</span>)
                        <span class="ruby-keyword">end</span>                 
                <span class="ruby-keyword">end</span>
                <span class="ruby-identifier">updates</span>.<span class="ruby-identifier">sort!</span>
                <span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;The following sites are now refreshed: #{updates}&quot;</span> <span class="ruby-keyword">if</span> <span class="ruby-ivar">@verbose</span>
                <span class="ruby-keyword">return</span> <span class="ruby-identifier">updates</span>
        <span class="ruby-keyword">rescue</span> <span class="ruby-constant">Exception</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">ee</span>
                <span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;Exception on method #{__method__}: #{ee}&quot;</span> <span class="ruby-keyword">if</span> <span class="ruby-ivar">@verbose</span>
        <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-save-21" class="method-detail method-alias">
        
        <div class="method-heading">
          <span class="method-name">save!</span><span
            class="method-args">(file_sites=@file_stores)</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
        </div>

        

        
        <div class="aliases">
          Alias for: <a href="SiteTracker.html#method-i-save_sites_to_file-21">save_sites_to_file!</a>
        </div>
        
      </div>

    
      <div id="method-i-save_sites_to_file-21" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">save_sites_to_file!</span><span
            class="method-args">(file_sites=@file_stores)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Save the current site store hash table into a file</p>
          
          

          
          <div class="method-source-code" id="save_sites_to_file-21-source">
            <pre><span class="ruby-comment"># File lib/wmap/site_tracker.rb, line 73</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">save_sites_to_file!</span>(<span class="ruby-identifier">file_sites</span>=<span class="ruby-ivar">@file_stores</span>)
        <span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;Saving the current site store table from memory to file: #{file_sites}&quot;</span> 
        <span class="ruby-keyword">begin</span>
                <span class="ruby-identifier">timestamp</span>=<span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>
                <span class="ruby-identifier">f</span>=<span class="ruby-constant">File</span>.<span class="ruby-identifier">open</span>(<span class="ruby-identifier">file_sites</span>, <span class="ruby-string">&#39;w&#39;</span>)
                <span class="ruby-identifier">f</span>.<span class="ruby-identifier">write</span> <span class="ruby-node">&quot;# Local site store created by class #{self.class} method #{__method__} at: #{timestamp}\n&quot;</span>
                <span class="ruby-identifier">f</span>.<span class="ruby-identifier">write</span> <span class="ruby-node">&quot;# Website,Primary IP,Port,Hosting Status,Server,Response Code,Site MD5 Finger-print,Site Redirection,Timestamp\n&quot;</span>
                <span class="ruby-ivar">@known_sites</span>.<span class="ruby-identifier">keys</span>.<span class="ruby-identifier">sort</span>.<span class="ruby-identifier">map</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">key</span><span class="ruby-operator">|</span>
                        <span class="ruby-identifier">f</span>.<span class="ruby-identifier">write</span> <span class="ruby-node">&quot;#{key},#{@known_sites[key][&#39;ip&#39;]},#{@known_sites[key][&#39;port&#39;]},#{@known_sites[key][&#39;status&#39;]},#{@known_sites[key][&#39;server&#39;]},#{@known_sites[key][&#39;code&#39;]},#{@known_sites[key][&#39;md5&#39;]},#{@known_sites[key][&#39;redirection&#39;]},#{@known_sites[key][&#39;timestamp&#39;]}\n&quot;</span>
                <span class="ruby-keyword">end</span>
                <span class="ruby-identifier">f</span>.<span class="ruby-identifier">close</span>
                <span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;site store table is successfully saved: #{file_sites}&quot;</span>
        <span class="ruby-keyword">rescue</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">ee</span>
                <span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;Exception on method #{__method__}: #{ee}&quot;</span>
        <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        
        <div class="aliases">
          Also aliased as: <a href="SiteTracker.html#method-i-save-21">save!</a>
        </div>
        

        
      </div>

    
      <div id="method-i-save_uniq_sites" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">save_uniq_sites</span><span
            class="method-args">(file)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Retrieve and save unique sites information for the quarterly scan into a
plain local file</p>
          
          

          
          <div class="method-source-code" id="save_uniq_sites-source">
            <pre><span class="ruby-comment"># File lib/wmap/site_tracker.rb, line 754</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">save_uniq_sites</span>(<span class="ruby-identifier">file</span>)
        <span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;Save unique sites information into a flat file: #{file}\nThis may take a long while as it go through a lengthy self correction check process, please be patient ...&quot;</span>
        <span class="ruby-keyword">begin</span>
                <span class="ruby-identifier">prime_sites</span>=<span class="ruby-identifier">get_prim_uniq_sites</span>
                <span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;Primary Sites: #{prime_sites}&quot;</span> <span class="ruby-keyword">if</span> <span class="ruby-ivar">@verbose</span>
                <span class="ruby-identifier">f</span>=<span class="ruby-constant">File</span>.<span class="ruby-identifier">open</span>(<span class="ruby-identifier">file</span>,<span class="ruby-string">&quot;w&quot;</span>)
                <span class="ruby-identifier">f</span>.<span class="ruby-identifier">write</span> <span class="ruby-string">&quot;Unique Sites Information Report\n&quot;</span>
                <span class="ruby-identifier">f</span>.<span class="ruby-identifier">write</span> <span class="ruby-string">&quot;Site, IP, Port, Server, Hosting, Response Code, MD5, Redirect, Timestamps\n&quot;</span>
                <span class="ruby-identifier">prime_sites</span>.<span class="ruby-identifier">map</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">key</span><span class="ruby-operator">|</span>
                        <span class="ruby-keyword">next</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">key</span>.<span class="ruby-identifier">nil?</span>
                        <span class="ruby-identifier">site</span>=<span class="ruby-identifier">key</span>.<span class="ruby-identifier">strip</span> 
                        <span class="ruby-identifier">raise</span> <span class="ruby-node">&quot;Unknown site: #{site}. You may need to add it into the site store first. Execute the following shell command before trying again: \n\wadd #{site}\n&quot;</span> <span class="ruby-keyword">unless</span> <span class="ruby-ivar">@known_sites</span>.<span class="ruby-identifier">key?</span>(<span class="ruby-identifier">site</span>)
                        <span class="ruby-identifier">ip</span>=<span class="ruby-ivar">@known_sites</span>[<span class="ruby-identifier">site</span>][<span class="ruby-string">&#39;ip&#39;</span>]
                        <span class="ruby-identifier">port</span>=<span class="ruby-ivar">@known_sites</span>[<span class="ruby-identifier">site</span>][<span class="ruby-string">&#39;port&#39;</span>]
                        <span class="ruby-identifier">status</span>=<span class="ruby-ivar">@known_sites</span>[<span class="ruby-identifier">site</span>][<span class="ruby-string">&#39;status&#39;</span>]
                        <span class="ruby-identifier">server</span>=<span class="ruby-ivar">@known_sites</span>[<span class="ruby-identifier">site</span>][<span class="ruby-string">&#39;server&#39;</span>]
                        <span class="ruby-identifier">fp</span>=<span class="ruby-ivar">@known_sites</span>[<span class="ruby-identifier">site</span>][<span class="ruby-string">&#39;md5&#39;</span>]
                        <span class="ruby-identifier">loc</span>=<span class="ruby-ivar">@known_sites</span>[<span class="ruby-identifier">site</span>][<span class="ruby-string">&#39;redirection&#39;</span>]
                        <span class="ruby-identifier">res</span>=<span class="ruby-ivar">@known_sites</span>[<span class="ruby-identifier">site</span>][<span class="ruby-string">&#39;code&#39;</span>]
                        <span class="ruby-identifier">timestamp</span>=<span class="ruby-ivar">@known_sites</span>[<span class="ruby-identifier">site</span>][<span class="ruby-string">&#39;timestamp&#39;</span>]
                        <span class="ruby-identifier">f</span>.<span class="ruby-identifier">write</span> <span class="ruby-node">&quot;#{site},#{ip},#{port},#{server},#{status},#{res},#{fp},#{loc},#{timestamp}\n&quot;</span>
                <span class="ruby-keyword">end</span>
                <span class="ruby-identifier">f</span>.<span class="ruby-identifier">close</span>
                <span class="ruby-identifier">puts</span> <span class="ruby-string">&quot;Done!&quot;</span>
                <span class="ruby-keyword">return</span> <span class="ruby-keyword">true</span>  <span class="ruby-comment"># success</span>
        <span class="ruby-keyword">rescue</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">ee</span>
                <span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;Exception on method #{__method__}: #{ee}&quot;</span>
                <span class="ruby-keyword">return</span> <span class="ruby-keyword">false</span> <span class="ruby-comment"># fail</span>
        <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        
        <div class="aliases">
          Also aliased as: <a href="SiteTracker.html#method-i-dump">dump</a>
        </div>
        

        
      </div>

    
      <div id="method-i-save_uniq_sites_xml" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">save_uniq_sites_xml</span><span
            class="method-args">(file)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Retrieve and save unique sites information for the quarterly scan into a
XML file</p>
          
          

          
          <div class="method-source-code" id="save_uniq_sites_xml-source">
            <pre><span class="ruby-comment"># File lib/wmap/site_tracker.rb, line 787</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">save_uniq_sites_xml</span>(<span class="ruby-identifier">file</span>)
        <span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;Save unique sites information into XML file: #{file}\nThis may take a long while as it go through lengthy self correctness check, please be patient ...&quot;</span>
        <span class="ruby-keyword">begin</span>
                <span class="ruby-identifier">prime_sites</span>=<span class="ruby-identifier">get_prim_uniq_sites</span>
                <span class="ruby-identifier">builder</span> = <span class="ruby-constant">Nokogiri</span><span class="ruby-operator">::</span><span class="ruby-constant">XML</span><span class="ruby-operator">::</span><span class="ruby-constant">Builder</span>.<span class="ruby-identifier">new</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">xml</span><span class="ruby-operator">|</span>
                        <span class="ruby-identifier">xml</span>.<span class="ruby-identifier">root</span> {
                                <span class="ruby-identifier">xml</span>.<span class="ruby-identifier">websites</span> {
                                        <span class="ruby-identifier">prime_sites</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">key</span><span class="ruby-operator">|</span>
                                                <span class="ruby-keyword">next</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">key</span>.<span class="ruby-identifier">nil?</span>
                                                <span class="ruby-identifier">site</span>=<span class="ruby-identifier">key</span>.<span class="ruby-identifier">strip</span>
                                                <span class="ruby-identifier">raise</span> <span class="ruby-node">&quot;Unknown site: #{site}. You may need to add it into the site store first. Execute the following shell command before trying again: \n\twmap #{site}\n&quot;</span> <span class="ruby-keyword">unless</span> <span class="ruby-ivar">@known_sites</span>.<span class="ruby-identifier">key?</span>(<span class="ruby-identifier">site</span>)
                                                <span class="ruby-identifier">xml</span>.<span class="ruby-identifier">site</span> {
                                                        <span class="ruby-identifier">xml</span>.<span class="ruby-identifier">name</span> <span class="ruby-identifier">site</span> 
                                                        <span class="ruby-identifier">xml</span>.<span class="ruby-identifier">ip_</span> <span class="ruby-ivar">@known_sites</span>[<span class="ruby-identifier">site</span>][<span class="ruby-string">&#39;ip&#39;</span>]
                                                        <span class="ruby-identifier">xml</span>.<span class="ruby-identifier">port_</span> <span class="ruby-ivar">@known_sites</span>[<span class="ruby-identifier">site</span>][<span class="ruby-string">&#39;port&#39;</span>]
                                                        <span class="ruby-identifier">xml</span>.<span class="ruby-identifier">status_</span> <span class="ruby-ivar">@known_sites</span>[<span class="ruby-identifier">site</span>][<span class="ruby-string">&#39;status&#39;</span>]
                                                        <span class="ruby-identifier">xml</span>.<span class="ruby-identifier">server_</span> <span class="ruby-ivar">@known_sites</span>[<span class="ruby-identifier">site</span>][<span class="ruby-string">&#39;server&#39;</span>]
                                                        <span class="ruby-identifier">xml</span>.<span class="ruby-identifier">fingerprint_</span> <span class="ruby-ivar">@known_sites</span>[<span class="ruby-identifier">site</span>][<span class="ruby-string">&#39;md5&#39;</span>]
                                                        <span class="ruby-identifier">xml</span>.<span class="ruby-identifier">redirection_</span> <span class="ruby-ivar">@known_sites</span>[<span class="ruby-identifier">site</span>][<span class="ruby-string">&#39;redirection&#39;</span>]
                                                        <span class="ruby-identifier">xml</span>.<span class="ruby-identifier">responsecode_</span> <span class="ruby-ivar">@known_sites</span>[<span class="ruby-identifier">site</span>][<span class="ruby-string">&#39;code&#39;</span>]
                                                        <span class="ruby-identifier">xml</span>.<span class="ruby-identifier">timestamp_</span> <span class="ruby-ivar">@known_sites</span>[<span class="ruby-identifier">site</span>][<span class="ruby-string">&#39;timestamp&#39;</span>]
                                                }
                                        <span class="ruby-keyword">end</span>
                                }
                        }
                <span class="ruby-keyword">end</span>
                <span class="ruby-identifier">puts</span> <span class="ruby-identifier">builder</span>.<span class="ruby-identifier">to_xml</span> <span class="ruby-keyword">if</span> <span class="ruby-ivar">@verbose</span>
                <span class="ruby-identifier">f</span>=<span class="ruby-constant">File</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">file</span>,<span class="ruby-string">&#39;w&#39;</span>)
                <span class="ruby-identifier">f</span>.<span class="ruby-identifier">write</span>(<span class="ruby-identifier">builder</span>.<span class="ruby-identifier">to_xml</span>)
                <span class="ruby-identifier">f</span>.<span class="ruby-identifier">close</span>
                <span class="ruby-identifier">puts</span> <span class="ruby-string">&quot;Done!&quot;</span>
                <span class="ruby-keyword">return</span> <span class="ruby-keyword">true</span>
        <span class="ruby-keyword">rescue</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">ee</span>
                <span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;Exception on method #{__method__}: #{ee}&quot;</span>
                <span class="ruby-keyword">return</span> <span class="ruby-keyword">false</span>
        <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        
        <div class="aliases">
          Also aliased as: <a href="SiteTracker.html#method-i-dump_xml">dump_xml</a>
        </div>
        

        
      </div>

    
      <div id="method-i-search" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">search</span><span
            class="method-args">(pattern)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Search potential matching sites from the site store by using simple regular
expression. Note that any upper-case char in the search string will be
automatically converted into lower case</p>
          
          

          
          <div class="method-source-code" id="search-source">
            <pre><span class="ruby-comment"># File lib/wmap/site_tracker.rb, line 693</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">search</span> (<span class="ruby-identifier">pattern</span>)
        <span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;Search site store based on the regular expression: #{pattern}&quot;</span> <span class="ruby-keyword">if</span> <span class="ruby-ivar">@verbose</span>
        <span class="ruby-keyword">begin</span>
                <span class="ruby-identifier">pattern</span>=<span class="ruby-identifier">pattern</span>.<span class="ruby-identifier">strip</span>.<span class="ruby-identifier">downcase</span>
                <span class="ruby-identifier">results</span>=<span class="ruby-constant">Array</span>.<span class="ruby-identifier">new</span>
                <span class="ruby-ivar">@known_sites</span>.<span class="ruby-identifier">keys</span>.<span class="ruby-identifier">map</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">key</span><span class="ruby-operator">|</span>
                        <span class="ruby-keyword">if</span> <span class="ruby-identifier">key</span> <span class="ruby-operator">=~</span> <span class="ruby-node">/#{pattern}/i</span>
                                <span class="ruby-identifier">results</span>.<span class="ruby-identifier">push</span>(<span class="ruby-identifier">key</span>)
                        <span class="ruby-keyword">end</span>
                <span class="ruby-keyword">end</span>
                <span class="ruby-keyword">return</span> <span class="ruby-identifier">results</span>
        <span class="ruby-keyword">rescue</span> <span class="ruby-constant">Exception</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">ee</span>
                <span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;Exception on method search: #{ee}&quot;</span> <span class="ruby-keyword">if</span> <span class="ruby-ivar">@verbose</span>
                <span class="ruby-keyword">return</span> <span class="ruby-keyword">nil</span>
        <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-site_check" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">site_check</span><span
            class="method-args">(site)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Quick check of the stored information of a site within the store</p>
          
          

          
          <div class="method-source-code" id="site_check-source">
            <pre><span class="ruby-comment"># File lib/wmap/site_tracker.rb, line 497</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">site_check</span>(<span class="ruby-identifier">site</span>)
        <span class="ruby-keyword">begin</span>
                <span class="ruby-identifier">raise</span> <span class="ruby-string">&quot;Web site store not loaded properly! &quot;</span> <span class="ruby-keyword">if</span> <span class="ruby-ivar">@known_sites</span>.<span class="ruby-identifier">nil?</span>
                <span class="ruby-identifier">site</span>=<span class="ruby-identifier">site</span>.<span class="ruby-identifier">strip</span>.<span class="ruby-identifier">downcase</span> <span class="ruby-keyword">unless</span> <span class="ruby-identifier">site</span>.<span class="ruby-identifier">nil?</span>
                <span class="ruby-identifier">site</span>=<span class="ruby-identifier">url_2_site</span>(<span class="ruby-identifier">site</span>)
                <span class="ruby-keyword">return</span> <span class="ruby-ivar">@known_sites</span>[<span class="ruby-identifier">site</span>] <span class="ruby-keyword">unless</span> <span class="ruby-identifier">site</span>.<span class="ruby-identifier">nil?</span>
        <span class="ruby-keyword">rescue</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">ee</span>
                <span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;Exception on method #{__method__}: #{ee}&quot;</span>
                <span class="ruby-keyword">return</span> <span class="ruby-keyword">nil</span>
        <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        
        <div class="aliases">
          Also aliased as: <a href="SiteTracker.html#method-i-check">check</a>
        </div>
        

        
      </div>

    
      <div id="method-i-site_ip_known-3F" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">site_ip_known?</span><span
            class="method-args">(ip)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Quick validation check on an IP is already part of the site store</p>
          
          

          
          <div class="method-source-code" id="site_ip_known-3F-source">
            <pre><span class="ruby-comment"># File lib/wmap/site_tracker.rb, line 476</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">site_ip_known?</span>(<span class="ruby-identifier">ip</span>)
        <span class="ruby-keyword">begin</span>
                <span class="ruby-identifier">ip</span>=<span class="ruby-identifier">ip</span>.<span class="ruby-identifier">chomp</span>.<span class="ruby-identifier">strip</span>
                <span class="ruby-identifier">known</span>=<span class="ruby-keyword">false</span>
                <span class="ruby-keyword">if</span> <span class="ruby-identifier">is_ip?</span>(<span class="ruby-identifier">ip</span>)
                        <span class="ruby-ivar">@known_sites</span>.<span class="ruby-identifier">keys</span>.<span class="ruby-identifier">map</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">site</span><span class="ruby-operator">|</span>
                                <span class="ruby-keyword">if</span> <span class="ruby-ivar">@known_sites</span>[<span class="ruby-identifier">site</span>][<span class="ruby-string">&#39;ip&#39;</span>]<span class="ruby-operator">==</span><span class="ruby-identifier">ip</span>
                                        <span class="ruby-keyword">return</span> <span class="ruby-keyword">true</span>
                                <span class="ruby-keyword">end</span>
                        <span class="ruby-keyword">end</span>
                <span class="ruby-keyword">end</span>
                <span class="ruby-identifier">myDis</span>=<span class="ruby-keyword">nil</span>
                <span class="ruby-keyword">return</span> <span class="ruby-identifier">known</span>
        <span class="ruby-keyword">rescue</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">ee</span>
                <span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;Exception on method #{__method__}: #{ee}&quot;</span>
                <span class="ruby-keyword">return</span> <span class="ruby-keyword">false</span>
        <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        
        <div class="aliases">
          Also aliased as: <a href="SiteTracker.html#method-i-siteip_known-3F">siteip_known?</a>
        </div>
        

        
      </div>

    
      <div id="method-i-site_known-3F" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">site_known?</span><span
            class="method-args">(site)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Quick validation if a site is already covered under the site store</p>
          
          

          
          <div class="method-source-code" id="site_known-3F-source">
            <pre><span class="ruby-comment"># File lib/wmap/site_tracker.rb, line 462</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">site_known?</span>(<span class="ruby-identifier">site</span>)
        <span class="ruby-keyword">begin</span>
                <span class="ruby-identifier">raise</span> <span class="ruby-string">&quot;Web site store not loaded properly! &quot;</span> <span class="ruby-keyword">if</span> <span class="ruby-ivar">@known_sites</span>.<span class="ruby-identifier">nil?</span>
                <span class="ruby-identifier">site</span>=<span class="ruby-identifier">site</span>.<span class="ruby-identifier">strip</span>.<span class="ruby-identifier">downcase</span> <span class="ruby-keyword">unless</span> <span class="ruby-identifier">site</span>.<span class="ruby-identifier">nil?</span>
                <span class="ruby-identifier">site</span>=<span class="ruby-identifier">url_2_site</span>(<span class="ruby-identifier">site</span>)
                <span class="ruby-keyword">return</span> <span class="ruby-ivar">@known_sites</span>.<span class="ruby-identifier">key?</span>(<span class="ruby-identifier">site</span>) <span class="ruby-keyword">unless</span> <span class="ruby-identifier">site</span>.<span class="ruby-identifier">nil?</span>
        <span class="ruby-keyword">rescue</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">ee</span>
                <span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;Error checking web site #{site} against the site store: #{ee}&quot;</span>
        <span class="ruby-keyword">end</span>
        <span class="ruby-keyword">return</span> <span class="ruby-keyword">false</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        
        <div class="aliases">
          Also aliased as: <a href="SiteTracker.html#method-i-is_known-3F">is_known?</a>
        </div>
        

        
      </div>

    
      <div id="method-i-siteip_known-3F" class="method-detail method-alias">
        
        <div class="method-heading">
          <span class="method-name">siteip_known?</span><span
            class="method-args">(ip)</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
        </div>

        

        
        <div class="aliases">
          Alias for: <a href="SiteTracker.html#method-i-site_ip_known-3F">site_ip_known?</a>
        </div>
        
      </div>

    
      <div id="method-i-uniq_sites" class="method-detail method-alias">
        
        <div class="method-heading">
          <span class="method-name">uniq_sites</span><span
            class="method-args">()</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
        </div>

        

        
        <div class="aliases">
          Alias for: <a href="SiteTracker.html#method-i-get_uniq_sites">get_uniq_sites</a>
        </div>
        
      </div>

    
    </section>
  
  </section>
</main>


<footer id="validator-badges" role="contentinfo">
  <p><a href="http://validator.w3.org/check/referer">Validate</a>
  <p>Generated by <a href="http://docs.seattlerb.org/rdoc/">RDoc</a> 4.2.0.
  <p>Based on <a href="http://deveiate.org/projects/Darkfish-RDoc/">Darkfish</a> by <a href="http://deveiate.org">Michael Granger</a>.
</footer>

